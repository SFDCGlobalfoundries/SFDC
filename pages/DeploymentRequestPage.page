<apex:page standardController="Deployment_Request__c" extensions="DeploymentRequestController,RemotingActionJS" tabStyle="Deployment_Request__c">
<script type="text/javascript">
    function fetchChangeTypeValuesfn(sval){
        Visualforce.remoting.Manager.invokeAction(
            '{!$RemoteAction.RemotingActionJS.fetchChangeTypeValues}',
            sval.value, 
            function(result, event){
                if(event.status) {                    
                    var changeTypeVals = result;
                    var changeTypeId = document.getElementById('j_id0:drform:drblock:j_id31:j_id39:changeTypeList');
                    changeTypeId.innerHTML = '';
                    for(var i=0; i<result.length; i++){
                        var option = document.createElement("option");
                        option.value = result[i];
                        option.text = result[i];
                        changeTypeId.appendChild(option);
                    }                    
                } else if (event.type === 'exception') {
                    document.getElementById("responseErrors").innerHTML = event.message + "<br/>\n<pre>" + event.where + "</pre>";
                } else {
                    document.getElementById("responseErrors").innerHTML = event.message;
                }
            }, 
            {escape: true}
        );
    }

    function fetchApplicationNameValuesfn(sval){
        Visualforce.remoting.Manager.invokeAction(
            '{!$RemoteAction.RemotingActionJS.fetchApplicationNameValues}',
            sval.value, 
            function(result, event){
                if(event.status) {                    
                    var changeTypeVals = result;
                    var applicationNameId = document.getElementById('j_id0:drform:drblock:j_id31:j_id70:applicationNameList');
                    applicationNameId.innerHTML = '';
                    //alert(changeTypeId);
                    for(var i=0; i<result.length; i++){
                        var option = document.createElement("option");
                        option.value = result[i];
                        option.text = result[i];
                        applicationNameId.appendChild(option);
                    }                    
                } else if (event.type === 'exception') {
                    document.getElementById("responseErrors").innerHTML = event.message + "<br/>\n<pre>" + event.where + "</pre>";
                } else {
                    document.getElementById("responseErrors").innerHTML = event.message;
                }
            }, 
            {escape: true}
        );
    }
</script>
    <apex:form id="drform">
        <!-- <apex:actionFunction name="fetchChangeTypeValuesfn" action="{!fetchChangeTypeValues}" reRender="changeTypeList" oncomplete=""/>
        <apex:actionFunction name="fetchApplicationNameValuesfn" action="{!fetchApplicationNameValues}" reRender="applicationNameList" oncomplete=""/> -->
        <apex:pageBlock id="drblock">
            <apex:pageMessages ></apex:pageMessages>
            <apex:pageBlockButtons >
                <apex:commandButton value="Save" action="{!save}" reRender="drblock" onComplete=""/>
                <apex:commandButton value="Cancel" action="{!cancel}"/>
            </apex:pageBlockButtons>
            <apex:pageBlockSection title="Deployment Request Detail">
                <apex:pageBlockSectionItem >
                    <apex:outputText value="Request Type"></apex:outputText>
                    <apex:outputPanel layout="block" styleClass="requiredInput">
                    <apex:outputPanel layout="block" styleClass="requiredBlock"/>
                    <apex:selectList value="{!drObject.Request_Type_txt__c}" multiselect="false" size="1" onchange="fetchChangeTypeValuesfn(this)">
                        <apex:selectOptions value="{!requestType}"/>
                    </apex:selectList>     
                    </apex:outputPanel>           
                </apex:pageBlockSectionItem>
                <apex:outputField value="{!drObject.OwnerId}"/>
                <apex:pageBlockSectionItem >
                    <apex:outputText value="Change Type"></apex:outputText>
                    <apex:selectList value="{!drObject.Change_Type_txt__c}" multiselect="false" size="1" disabled="{!disableChangeType}" id="changeTypeList">
                        <apex:selectOptions value="{!changeType}"/>
                    </apex:selectList>                                    
                </apex:pageBlockSectionItem>
                <apex:inputField value="{!drObject.CR_Number__c}"/>
                <apex:pageBlockSectionItem >
                    <apex:outputText value="Source Environment"></apex:outputText>
                    <apex:outputPanel layout="block" styleClass="requiredInput">
                    <apex:outputPanel layout="block" styleClass="requiredBlock"/>                    
                    <apex:selectList value="{!drObject.Source_Environment_txt__c}" multiselect="false" size="1">
                        <apex:selectOptions value="{!sourceEnvironment}"/>
                    </apex:selectList> 
                    </apex:outputPanel>               
                </apex:pageBlockSectionItem>
                <apex:pageBlockSectionItem >
                    <apex:outputText value="Target Environment"></apex:outputText>
                    <apex:outputPanel layout="block" styleClass="requiredInput">
                    <apex:outputPanel layout="block" styleClass="requiredBlock"/>
                    <apex:selectList value="{!drObject.Target_Environment_txt__c}" multiselect="false" size="1">
                        <apex:selectOptions value="{!targetEnvironment}"/>
                    </apex:selectList>       
                    </apex:outputPanel>         
                </apex:pageBlockSectionItem>                                
                <apex:pageBlockSectionItem >
                    <apex:outputText value="Deployment Status"></apex:outputText>
                    <apex:selectList value="{!drObject.Deployment_Status_txt__c}" multiselect="false" size="1">
                        <apex:selectOptions value="{!deploymentStatus}"/>
                    </apex:selectList>                
                </apex:pageBlockSectionItem>                                
                <apex:pageBlockSectionItem >
                    <apex:outputText value="Review Status"></apex:outputText>
                    <apex:selectList value="{!drObject.RM_Review_Status_txt__c}" multiselect="false" size="1">
                        <apex:selectOptions value="{!reviewStatus}"/>
                    </apex:selectList>                
                </apex:pageBlockSectionItem>                                
                <apex:pageBlockSectionItem >
                    <apex:outputText value="Application Category"></apex:outputText>
                    <apex:outputPanel layout="block" styleClass="requiredInput">
                    <apex:outputPanel layout="block" styleClass="requiredBlock"/>                                        
                    <apex:selectList value="{!drObject.Application_Category_txt__c}" multiselect="false" size="1" onchange="fetchApplicationNameValuesfn(this)">
                        <apex:selectOptions value="{!applicationCategory}"/>
                    </apex:selectList>    
                    </apex:outputPanel>            
                </apex:pageBlockSectionItem>    
                <apex:inputField required="true" value="{!drObject.Deployment_Request_Date_Time__c}"/>                            
                <apex:pageBlockSectionItem >
                    <apex:outputText value="Application Name"></apex:outputText>
                    <apex:selectList value="{!drObject.Application_Name_txt__c}" multiselect="false" size="1" disabled="{!disableApplicationName}" id="applicationNameList">
                        <apex:selectOptions value="{!applicationName}"/>
                    </apex:selectList>                
                </apex:pageBlockSectionItem>      
                <apex:inputField value="{!drObject.Clarity_Project_Id__c}"/>
                <apex:inputField required="true" value="{!drObject.Short_Description__c}" style="width:315px;"/>
                <apex:inputField value="{!drObject.UAT_DR__c}"/>
                <apex:inputField required="true" value="{!drObject.Description__c}" style="width:315px;"/>   
                <apex:pageBlockSectionItem >
                    <apex:outputText value="System Affected"></apex:outputText>
                    <apex:selectList value="{!drObject.System_Affected_txt__c}" multiselect="true" size="4" style="width:200px;">
                        <apex:selectOptions value="{!systemAffected}"/>
                    </apex:selectList>                
                </apex:pageBlockSectionItem>      
                <apex:pageBlockSectionItem >
                    <apex:outputText value="Stage"></apex:outputText>
                    <apex:selectList value="{!drObject.Stage_txt__c}" multiselect="false" size="1">
                        <apex:selectOptions value="{!stages}"/>
                    </apex:selectList>                
                </apex:pageBlockSectionItem>      
                <apex:inputField value="{!drObject.Compliance_Review_Required__c}"/>                      
            </apex:pageBlockSection>
            <apex:pageBlockSection title="Review Information">
                <apex:pageBlockSectionItem >
                    <apex:outputText value="Is TFA Review Completed"></apex:outputText>
                    <apex:outputPanel layout="block" styleClass="requiredInput">
                    <apex:outputPanel layout="block" styleClass="requiredBlock"/>
                    <apex:selectList value="{!drObject.Is_TFA_Review_Completed_txt__c}" multiselect="false" size="1">
                        <apex:selectOptions value="{!tfaReviewCompleted}"/>
                    </apex:selectList>
                    </apex:outputPanel>                
                </apex:pageBlockSectionItem>
                <apex:inputField value="{!drObject.TFA_Review_User__c}"/>
                <apex:pageBlockSectionItem >
                    <apex:outputText value="Is TA Review Completed"></apex:outputText>
                    <apex:outputPanel layout="block" styleClass="requiredInput">
                    <apex:outputPanel layout="block" styleClass="requiredBlock"/>
                    <apex:selectList value="{!drObject.Is_TA_Review_Completed_txt__c}" multiselect="false" size="1">
                        <apex:selectOptions value="{!taReviewCompleted}"/>
                    </apex:selectList>   
                    </apex:outputPanel>             
                </apex:pageBlockSectionItem>
                <apex:inputField value="{!drObject.TA_Review_User__c}"/>
                <apex:pageBlockSectionItem >
                    <apex:outputText value="Is Code Review Completed"></apex:outputText>
                    <apex:outputPanel layout="block" styleClass="requiredInput">
                    <apex:outputPanel layout="block" styleClass="requiredBlock"/>
                    <apex:selectList value="{!drObject.Is_Code_Review_Completed_txt__c}" multiselect="false" size="1">
                        <apex:selectOptions value="{!codeReviewCompleted}"/>
                    </apex:selectList>   
                    </apex:outputPanel>             
                </apex:pageBlockSectionItem>                
                <apex:inputField value="{!drObject.Code_Review_User__c}"/>
                <apex:pageBlockSectionItem >
                    <apex:outputText value="Support KT Status"></apex:outputText>
                    <apex:outputPanel layout="block" styleClass="requiredInput">
                    <apex:outputPanel layout="block" styleClass="requiredBlock"/>
                    <apex:selectList value="{!drObject.Support_KT_Status_txt__c}" multiselect="false" size="1">
                        <apex:selectOptions value="{!supportKTStatus}"/>
                    </apex:selectList>  
                    </apex:outputPanel>              
                </apex:pageBlockSectionItem>                
                <apex:inputField value="{!drObject.Support_KT_Date__c}"/>
            </apex:pageBlockSection>
            <apex:pageBlockSection title="Release Management/SDM">
                <apex:inputField value="{!drObject.RM_Approval_Date__c}"/>
            </apex:pageBlockSection>
            <apex:pageBlockSection title="Deployment Status">
                <apex:inputField value="{!drObject.Administrator_to_Deploy__c}"/>
                <apex:inputField value="{!drObject.Deployment_End_Date_Time__c}"/>
                <apex:inputField value="{!drObject.Deployment_Start_Date_Time__c}"/>
                <apex:inputField value="{!drObject.Submitted_Date__c}"/>
                <apex:inputField value="{!drObject.Approval_Date__c}"/>
            </apex:pageBlockSection>                       
            <apex:pageBlockSection title="Deployment Comments">
                <apex:pageBlockSectionItem >
                    <apex:outputText value="Additional Notes"></apex:outputText>
                    <apex:selectList value="{!drObject.Additional_Comments_txt__c}" multiselect="true" size="4">
                        <apex:selectOptions value="{!additionalNotes}"/>
                    </apex:selectList>                
                </apex:pageBlockSectionItem>                
                <apex:inputField value="{!drObject.Administrator_Comment__c}" style="width:200px;"/>
            </apex:pageBlockSection>                               
            </apex:pageBlock>
    </apex:form>
</apex:page>