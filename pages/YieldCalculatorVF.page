<!--
    Author: Zymark Ambat
    Description: This serves as the VF for YieldCalculatorController.
    History: 
        ZAmbat      11272014    - Page creation.
-->

<apex:page id="YieldCalculatorVF" controller="YieldCalculatorController" sidebar="false" showHeader="false">
    <apex:includeScript value="{!URLFOR($Resource.jquery, 'js/jquery-1.8.3.js')}" />
    <script>
        $(document).ready(function(){
            $("[id$='processId']").attr('readonly', 'true');
            if ($("[id$='processId']").val() == '') { 
                $("[id$='processId']").val("Click lookup icon...");
            }
            
            $("[id$='dieSizeX']").keyup(function(e){
                var result = $(this).val() * $("[id$='dieSizeY']").val();
                if ($.isNumeric(result)) {
                    $("[id$='dieSizeArea']").val(result.toFixed(1));
                } else {
                    $("[id$='dieSizeArea']").val("0.0");      
                }
            });
            
            $("[id$='dieSizeY']").keyup(function(e){
                var result = $(this).val() * $("[id$='dieSizeX']").val();
                if ($.isNumeric(result)) {
                    $("[id$='dieSizeArea']").val(result.toFixed(1));
                } else {
                    $("[id$='dieSizeArea']").val("0.0");      
                }
            });
        });
        
        function openLookup(baseURL, width, modified, searchParam) {
            var originalbaseURL = baseURL;
            var originalwidth = width;
            openPopup(originalbaseURL, "lookup", 350, 480, "width=" + width + ", height=480, toolbar=no, status=no, directories=no, menubar=no, resizable=yes, scrollable=no", true);
        }
        
        function rebindAction() {
            $("[id$='processId']").attr('readonly', 'true');
            if ($("[id$='processId']").val() == '') { 
                $("[id$='processId']").val("Click lookup icon...");
            }
            
            $("[id$='dieSizeX']").keyup(function(e){
                var result = $(this).val() * $("[id$='dieSizeY']").val();
                if ($.isNumeric(result)) {
                    $("[id$='dieSizeArea']").val(result.toFixed(1));
                } else {
                    $("[id$='dieSizeArea']").val("0.0");      
                }
            });
            
            $("[id$='dieSizeY']").keyup(function(e){
                var result = $(this).val() * $("[id$='dieSizeX']").val();
                if ($.isNumeric(result)) {
                    $("[id$='dieSizeArea']").val(result.toFixed(1));
                } else {
                    $("[id$='dieSizeArea']").val("0.0");      
                }
            });
        }
        
        function validateValues() {
            if ($("[id$='nValue']").val() == "") { 
                alert("Please provide value for N Value.");
                rebindAction();
                $("[id$='nValue']").focus();
                return false;
            } else if ($("[id$='defectDensity']").val() == "") { 
                alert("Please provide value for Defect Density.");
                rebindAction();
                $("[id$='defectDensity']").focus();
                return false;
            } else if ($("[id$='dieSizeX']").val() == "") { 
                alert("Please provide value for Die Size X.");
                rebindAction();
                $("[id$='dieSizeX']").focus();
                return false;
            } else if ($("[id$='dieSizeY']").val() == "") { 
                alert("Please provide value for Die Size Y.");
                rebindAction();
                $("[id$='dieSizeY']").focus();
                return false;
            } else if ($("[id$='dieSizeArea']").val() == "") { 
                alert("Please provide value for Die Size (Area).");
                rebindAction();
                $("[id$='dieSizeArea']").focus();
                return false;
            } else {
                checkLookupValue();
                refreshBlock();
            }
        }
        
        function checkLookupValue() {
            if ($("[id$='processId']").val() == "Click lookup icon...") { 
                $("[id$='processId']").val("");
            }
        }
        
        function showImage(id) {
            document.getElementById(id).style.display = "inline";
        }
        
        function hideImage(id) {
            document.getElementById(id).style.display = "none";
        }
    </script>
    
    <style>
        body .bPageBlock .pbBody .grey .pbSubheader {
            background-color: #c00;
        }
        
        body .bPageBlock .pbBody .grey .pbSubheader h3 {
            color: white;
        }
    </style>
    
    <apex:form id="form1">
        <apex:pageBlock id="block1" mode="detail">
             <apex:pageBlockButtons location="both">
                <apex:commandButton value="Estimate Yield" rerender="secYieldEstimation, secEstimatedYield, secGrossDiesPerWafer, secNetDiesPerWafer" onclick="return validateValues();" status="status1" />
                <apex:commandButton value="Clear All" action="{!clearAll}" onclick="checkLookupValue();" oncomplete="rebindAction();" rerender="form1" status="status1" />
                <apex:actionStatus startText="Processing..." stopText="" id="status1" layout="inline" onstart="showImage('div1');" onstop="hideImage('div1');" />
                <div id="div1" style="display: none;">
                    <apex:image value="{!$Resource.LoadingGIF}" width="16" height="16" /> 
                </div>
             </apex:pageBlockButtons>
             
             <apex:outputPanel id="warningPanel" styleClass="grey" layout="block">
                 <apex:pageBlockSection columns="1" title="Important Please Read:" collapsible="false">
                     <apex:outputText value="{!$Label.YieldCalculatorWarning}" style="font-weight: bold;" />
                 </apex:pageBlockSection>
             </apex:outputPanel>

             <apex:pageBlockSection id="secYieldEstimation" columns="2" title="Yield Estimation" collapsible="false">
                 <apex:pageBlockSectionItem >
                     <apex:outputLabel value="Wafer Size (mm)" />
                     <apex:selectList value="{!waferSize}" title="Wafer Size (mm)" size="1">
                         <apex:selectOptions value="{!WaferSizeOptions}"/>
                     </apex:selectList>
                 </apex:pageBlockSectionItem>
                 
                 <apex:pageBlockSectionItem >
                     <apex:outputLabel value="Process ID" />
                     <apex:actionRegion >
                         <apex:inputField id="processId" value="{!npcForm.Process_ID__c}">
                             <apex:actionSupport event="onchange" action="{!retrieveProcessDetails}" reRender="nValue" status="status2" />
                         </apex:inputField>
                         <apex:commandLink action="{!clearProcessId}" value="Clear" onclick="checkLookupValue();" oncomplete="rebindAction();" reRender="processId, nValue" status="status2" />
                         <apex:actionStatus startText="" stopText="" id="status2" layout="inline" onstart="showImage('div2');" onstop="hideImage('div2');" />
                         <div id="div2" style="display: none;">
                             <apex:image value="{!$Resource.LoadingGIF}" width="16" height="16" /> 
                         </div>
                     </apex:actionRegion>
                 </apex:pageBlockSectionItem>
                 
                 <apex:pageBlockSectionItem >
                     <apex:outputLabel value="N Value (n)" />
                     <apex:inputText id="nValue" value="{!nValue}" />
                 </apex:pageBlockSectionItem>
                 
                 <apex:pageBlockSectionItem >
                     <apex:outputLabel value="Defect Density (D<sub>0</sub>) (mm<sup>2</sup>)" escape="false" />
                     <apex:inputText id="defectDensity" value="{!defectDensity}" />
                 </apex:pageBlockSectionItem>
                 
                 <apex:pageBlockSectionItem >
                     <apex:outputLabel value="Die Size X (mm)" />
                     <apex:inputText id="dieSizeX" value="{!dieSizeX}" />
                 </apex:pageBlockSectionItem>
                 
                 <apex:pageBlockSectionItem >
                     <apex:outputLabel value="Die Size Y (mm)" />
                     <apex:inputText id="dieSizeY" value="{!dieSizeY}" />
                 </apex:pageBlockSectionItem>
                 
                 <apex:pageBlockSectionItem >
                     <apex:outputLabel value="Die Size (Area) (mm<sup>2</sup>)" escape="false" />
                     <apex:inputText id="dieSizeArea" value="{!dieSizeArea}" />
                 </apex:pageBlockSectionItem>
                 
                 <apex:pageBlockSectionItem >
                     <apex:outputLabel value="% of SRAM Density" />
                     <apex:selectList value="{!sramDensity}" title="% of SRAM Density" size="1">
                         <apex:selectOptions value="{!SramDensityOptions}"/>
                     </apex:selectList>
                 </apex:pageBlockSectionItem>
             </apex:pageBlockSection>
             
             <apex:pageBlockSection id="secEstimatedYield" columns="2" title="Estimated Yield" collapsible="false" rendered="true">
                 <apex:pageBlockSectionItem >
                     <apex:outputLabel value="Process ID" />
                     <apex:outputText value="{!processName}" />
                 </apex:pageBlockSectionItem>
                 
                 <apex:pageBlockSectionItem >
                     <apex:outputLabel value="Defect Density (D<sub>0</sub>)" escape="false" />
                     <apex:outputText value="{!defectDensity}" />
                 </apex:pageBlockSectionItem>
                 
                 <apex:pageBlockSectionItem >
                     <apex:outputLabel value="Die Size (A) (inch<sup>2</sup>)" escape="false" />
                     <apex:outputText value="{!dieSizeArea}" />
                 </apex:pageBlockSectionItem>
                 
                 <apex:pageBlockSectionItem >
                     <apex:outputLabel value="N Value (n)" />
                     <apex:outputText value="{!nValue}" />
                 </apex:pageBlockSectionItem>
                 
                 <apex:pageBlockSectionItem >
                     <apex:outputLabel value="Estimated Yield" />
                     <apex:outputPanel >
                         <apex:outputText value="{0,number,0}" >
                             <apex:param value="{!EstimatedYield}" />
                         </apex:outputText>
                         <apex:outputText value="%" rendered="{!NOT(ISNULL(EstimatedYield))}" />
                     </apex:outputPanel>
                 </apex:pageBlockSectionItem>
             </apex:pageBlockSection>  
             
             <apex:pageBlockSection id="secGrossDiesPerWafer" columns="1" title="Gross Dies Per Wafer" collapsible="false" rendered="true">
                 <apex:pageBlockSectionItem >
                     <apex:outputLabel value="Gross Dies Per Wafer (GDPW)" />
                     <apex:outputText value="{!GrossDiesPerWafer}" />
                 </apex:pageBlockSectionItem>
             </apex:pageBlockSection>
             
             <apex:pageBlockSection id="secNetDiesPerWafer" columns="1" title="Net Dies Per Wafer" collapsible="false" rendered="true">
                 <apex:pageBlockSectionItem >
                     <apex:outputLabel value="Net Dies Per Wafer (NDPW)" />
                     <apex:outputText value="{!NetDiesPerWafer}" />
                 </apex:pageBlockSectionItem>
             </apex:pageBlockSection>   
        </apex:pageBlock>
        <apex:actionFunction name="refreshBlock" oncomplete="rebindAction();" rerender="warningPanel, secYieldEstimation, secEstimatedYield, secGrossDiesPerWafer, secNetDiesPerWafer" status="status1" />
    </apex:form>
</apex:page>