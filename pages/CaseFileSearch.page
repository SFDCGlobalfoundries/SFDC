<!-- 
   Type Name: CaseFileSearch.page
   Author: Cognizant Case Mgmt Team
   Created Date: 15-Dec-2014
   Reason: 
   Change History:
   Author: 
   Modified Date: 
   Reason: 
   -->
<apex:page title="Case File Search" readOnly="true" controller="CaseFileSearchController" showChat="false" cache="true" sidebar="false" tabStyle="Case" id="CaseFileSearch">
   <apex:form id="TheForm">
      <apex:pageBlock mode="mainDetails" title="Attachments and Files (Chatter) Search :" id="pageblock1" >
         <div class="search-block">
            <div class="rowText">
               <table width="100%" style="border-collapse: collapse;">
                  <tr >
                     <td style="width: 9%; align:left;"> 
                        <span>File Name:</span>
                     </td>
                     <td style="width: 25%; align:left;">
                        <div style="display: inline-table" class="col-md-6">
                           <apex:inputText value="{!SearchName}" />
                        </div>
                     </td>
                     <td style="width: 9%; align:left;"> 
                        <span>Uploaded By:</span>
                     </td>
                     <td style="width: 25%; align:left;">
                        <div style="display: inline-table" class="col-md-6">
                           <apex:inputText value="{!creator}" />
                        </div>
                     </td>
                     <td style="width: 9%; align:left;"> 
                        <span>Case Number:</span>
                     </td>
                     <td style="width: 25%; align:left;">
                        <div style="display: inline-table" class="col-md-6">
                           <apex:inputText value="{!caseNumber}" />
                        </div>
                     </td>                     
                  </tr>
                  <tr >                     
                     <td style="width: 9%; align:left;"> 
                        <span>Attachment\Chatter:</span>
                     </td>
                     <td style="width: 25%; align:left;">
                        <div style="display: inline-table" class="col-md-4">
                           <apex:selectList value="{!fileTypes}" multiselect="false" size="1" >
                              <apex:selectOptions value="{!attChatterValues}"/>
                           </apex:selectList>
                        </div>
                     </td>
                     <td style="width: 10%; align:left;"> 
                        <span>Uploaded Date:</span>
                     </td>
                     <td style="width: 25%; align:left;">
                        <div style="display: inline-table" class="col-md-4">
                           <apex:selectList value="{!createdDate}" multiselect="false" size="1" >
                              <apex:selectOptions value="{!datesFilter}"/>
                           </apex:selectList>
                        </div>
                     </td>
                     <td style="width: 10%; align:left;">
                     </td>
                     <td style="width: 25%; align:left;">                        
                     </td>
                  </tr>
               </table>
            </div>
         </div>
         <!-- ******************************************************* -->
         <!-- Search buttons       -->
         <div class="process-block">
            <apex:actionStatus id="ProcessButtonStatus">
               <apex:facet name="stop">
                  <apex:outputPanel >
                     <apex:commandButton styleClass="search-block-button" value="Search" action="{!SearchCaseAttachment}" rerender="TablePanel" status="TableUpdateStatus"/>
                     <apex:commandButton styleClass="process-block-button" value="Clear All" action="{!ClearAll}" rerender="TheForm,TablePanel" status="ProcessButtonStatus"/>
                     <apex:commandButton styleclass="process-block-button" value="Close" onclick="closePage()" Immediate="true" status="ProcessButtonStatus" rerender="nothing"/>
                  </apex:outputPanel>
               </apex:facet>
               <apex:facet name="start">
                  <apex:outputPanel >
                     <apex:commandButton styleClass="process-block-button" value="Processing..." disabled="true" />
                     <apex:commandButton styleClass="process-block-button" value="Processing..." disabled="true" />
                     <apex:commandButton styleClass="process-block-button" value="Processing..." disabled="true" />
                  </apex:outputPanel>
               </apex:facet>
            </apex:actionStatus>
         </div>
      </apex:pageBlock>
      <!-- ******************************************************* -->
      <!-- search results table      -->
      <apex:pageBlock id="TablePanel" title="Total Number of Attachments and Files : {!totalRecords}">
         <div>
            <span class="page-buttonNext">
               <apex:commandButton value="<< Previous"  rerender="TablePanel" action="{!Previous}" disabled="{!!hasprevious}" status="TableUpdateStatus"/>
               <apex:commandButton value="Next >>"  rerender="TablePanel" action="{!Next}" disabled="{!!hasnext}" status="TableUpdateStatus"/>
            </span>
            <span style="float: right; margin: 5px 5px 5px 5px;">
               <apex:repeat value="{!AlphaList}" var="a">
                  <apex:commandLink value="{!a}" action="{!SearchCaseAttachment}" rerender="TablePanel"
                     styleClass="alpha-link{!if(AlphaFilter=a,' alpha-select','')}" status="TableUpdateStatus">
                     <apex:param name="AlphaFilter" value="{!a}" assignTo="{!AlphaFilter}" />
                  </apex:commandLink>
               </apex:repeat>
            </span>
         </div>
         <div style="clear: both;"></div>
         <apex:actionStatus id="TableUpdateStatus">
            <apex:inputHidden value="{!AlphaFilter}" id="hiddenField" />
            <!-- ******************************************************* -->
            <!-- loading message -->
            <apex:facet name="start">
               <apex:outputPanel layout="block" styleClass="message infoM4">
                  <apex:panelGrid columns="2" styleClass="messageTable" columnClasses="messageCell" style="padding:0px;margin:0px;">
                     <apex:panelGroup >
                        <img class="loading-icon" src="/s.gif" />
                     </apex:panelGroup>
                     <apex:panelGroup >
                        <div class="messageText">Please wait...</div>
                     </apex:panelGroup>
                  </apex:panelGrid>
               </apex:outputPanel>
            </apex:facet>
            <apex:facet name="stop">
               <apex:pageBlockTable value="{!pageFileList}" var="a" id="TablePanel1" style="padding-top: 15px;">
                  <apex:column style="width:40px" headerValue="View">
                     <apex:outputLink value="{!a.urlDownload}" target="_blank" title="View - {!a.Name}">View</apex:outputlink>
                  </apex:column>
                  <apex:column style="width:200px">
                     <apex:facet name="header">
                        <apex:commandLink action="{!SortToggle}" rerender="TablePanel" status="TableUpdateStatus">
                           <apex:param name="SortField" value="Name" assignTo="{!SortField}" />
                           <apex:outputText value="Name{!IF(SortDirection='asc','▲','▼')}" />
                        </apex:commandLink>
                     </apex:facet>
                     <apex:outputLink value="/{!a.Id}" target="_blank" title="{!a.Name}">{!a.Name}</apex:outputlink>
                  </apex:column>
                  <apex:column headerValue="Description" value="{!a.Description}" style="width:200px"> 
                  </apex:column>
                  <apex:column headerValue="Size (KB)" value="{!a.Size}" style="width:80px" > 
                  </apex:column>
                  <apex:column headerValue="Case Number" style="width:80px" >
                     <apex:outputLink value="/{!a.ParentID}" target="_blank">{!a.Parent}</apex:outputlink>
                  </apex:column>
                  <apex:column headerValue="Uploaded By" style="width:120px" >
                     <apex:outputLink value="/{!a.OwnerId}" target="_blank">{!a.OwnerName}</apex:outputlink>
                  </apex:column>
                  <apex:column headerValue="Public" style="width:50px" >
                     <apex:inputCheckbox value="{!a.isPublic}" disabled="true" />
                  </apex:column>
                  <apex:column headerValue="Created Date" style="width:80px">
                     <apex:outputText value="{0,date,MM'/'dd'/'yyyy}">
                        <apex:param value="{!a.CreatedDate}" />
                     </apex:outputText>
                  </apex:column>
                  <apex:column headerValue="Chatter?" style="width:40px" >
                     <apex:inputCheckbox value="{!a.aCheckBox}" disabled="true" />
                  </apex:column>
               </apex:pageBlockTable>
            </apex:facet>
         </apex:actionStatus>
         <div style="margin-top: 5px;">
            <apex:outputText value="Number of Records per Page: " />
            <apex:selectList value="{!RecPerPage}" size="1">
               <apex:selectOptions value="{!RecPerPageOption}" />
               <apex:actionSupport event="onchange" action="{!resetPagination}" reRender="TablePanel" status="TableUpdateStatus"  />
            </apex:selectList>
         </div>
      </apex:pageBlock>
   </apex:form>
   <style type="text/css">
      .loading-icon {
      background-image: url(/img/loading.gif);
      width: 16px;
      height: 16px;
      } 
      a.alpha-link {
      font-weight: normal;
      font-size: 91%;
      padding: 0 4px;
      color: #015BA7 !important;
      } 
      a.alpha-link+a.alpha-link {
      border-left: 1px solid #CFCECE;
      }
      a.alpha-link:hover {
      background-color: #e0f5fc !important;
      } 
      a.alpha-select {
      font-weight: bold;
      text-decoration: none;
      background-color: #C6E1FF;
      color: #000000 !important;
      }
      .casetable {
      height: 200px;
      overflow-y: scroll;
      }
      .search-block {
      text-align: left;
      }
      .search-block input {
      margin: 0px 0px 1px 0px;
      }
      .search-block-button {
      min-width: 110px;
      }
      .search-block span{
      font-weight: bold;
      }
      .rowText {
      padding-bottom: 20px;
      }
      .rowPicklist1 {
      padding-bottom: 20px;
      }
      .process-block {
      text-align: center;
      margin-top: 1px;
      } 
      .process-block input {
      margin: 0px 5px;
      }
      .process-block-button {
      min-width: 100px;
      }
      .page-buttons input {
      min-width: 100px;
      }
      .page-buttonNext input {
      min-width: 70px;
      }
   </style>
   <script>    
      function closePage() {
          if(confirm("Are you sure you want to close this page? Attachments And Files (Chatter) search results will be lost, please click OK to close and cancel to continue.")){
              window.open('','_parent','');
              window.top.close();
          }
      }   
   </script>
</apex:page>