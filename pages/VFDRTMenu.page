<!--
 Type Name: VFDRTMenu
 Author: Cognizant Technology Solutions
 Created Date: 14-April-2014
 Modified Date: 
 Reason: This class is responsible for showing the DRT Menu for Internal user.
 Change History:
 Author: 
 Modified Date: 
 Reason: 
 …….. 
 ……..
-->
<apex:page sidebar="false" controller="DRTMenuExtn" id="drtmenupage">
  <!---------------------------------------------------     StyleSheet    -------------------------------------------------------------->
    <apex:stylesheet value="{!URLFOR($Resource.NewFV2Styles, 'NewFV2Styles/css/style.css')}" id="stylesheet_location"/>
    <apex:stylesheet value="{!URLFOR($Resource.SWIFT_MYDEVICE, 'css/style.css')}"/>
    <style>
        .use-sidebar #leftpanel {
            width:13%;
            min-width:13%;
        }
        .use-sidebar .drt-width-internal#content {
            width:86%;
        }
        
    </style>
    <!------------------------------------------------------------------------------------------------------------------------------------>
    <!-------------------------------------------------     JS File   ------------------------------------------------------------------>
    <apex:includeScript value="{!URLFOR($Resource.NewFV2Styles, 'NewFV2Styles/js/jquery.min.js')}" id="jqueryminjs_location"/>
    <apex:includeScript value="{!URLFOR($Resource.Swift_DRT, 'js/advancedDataGrid.js')}"/>
    <apex:includeScript value="{!URLFOR($Resource.NewFV2Styles, 'NewFV2Styles/js/leftmenunew.js')}" id="leftmenujs_location"/>
    <!------------------------------------------------------------------------------------------------------------------------------------>
    <apex:form id="myform">
        <input type="hidden" id="showSearchDRTLink" value="{!showSearchDRTLink}"/>    
        <div id="wrapper">
            <div id="container" class="use-sidebar ">
                <div id="leftpanel">
                    <div id="leftmenu">
                        <ul id="nav" class="leftnav">
                            <li> <a id="drt" href="#" class="open">DRT</a>
                                <ul class="selected-underscore" style="display:none;">
                                    <apex:outputLabel rendered="{!showCreateDRTLink}"><li><a href="#" onclick="OpenPage('CreateDRT'); return false;">Create</a></li></apex:outputLabel>
                                    <apex:outputLabel rendered="{!showSearchDRTLink}"><li><a href="#" onclick="OpenPage('SearchDRT'); return false;">Search</a></li></apex:outputLabel>                  
                                </ul>
                            </li>              
                        </ul>
                    </div>
                    <a href="#" id="separator" style="height: 537px;"></a>
                </div>
                
                <!-- Start of Right side content-->
                <div id="content" class="drt-width-internal">
                    <apex:pageBlock id="mainpb">
                        <apex:outputPanel rendered="true" id="detailpb">
                            <apex:image url="{!URLFOR($Resource.NewFV2Styles,'NewFV2Styles/images/GF_Devices-thumbnail.png')}" width="30px" height="30px" id="subject_image"/>
                            <apex:outputLabel value="{!respectiveLevel}" id="label" style="position:absolute;vertical-align:bottom;font-size:17px;font-style:normal;margin-top:10px"/>
                            <hr color="#ccced0" size="1" width="100%"/>
                            <apex:iframe width="100%" height="800px" src="{!OpenPageURL}" scrolling="false" id="frameSwift"/>
                        </apex:outputPanel>
                    </apex:pageBlock>
                </div>
            </div>
        </div>
        <apex:actionFunction action="{!redirect}" name="OpenPage" reRender="label,mainpb,welcomepb,detailpb,frame">
            <apex:param assignTo="{!Page}" value="" name="param1"/>
        </apex:actionFunction>
        <apex:inputHidden id="hiddenIframeParam" value="{!iframeParam}"/> 
    </apex:form>
    <script>
        function getFrameMiddleHeight() {
            var gh = 255;
            var h = jQuery(window).scrollTop()-gh+(jQuery(window).height()/2);
            h = (h<120)?120:h;
            return h;
        }
        function iframeLoaded() {
          var iFrameID = document.getElementById('frameSwift');
          if(iFrameID) {
              iFrameID.height = "";
              iFrameID.height = iFrameID.contentWindow.document.body.scrollHeight+50 + "px";
          }   
        }
        function openNode(links){
            jQuery('#drt').trigger('click');    
            var subMenu = $('#drt').siblings("ul").find("li").eq(links[0]);
            if((subMenu != null) && (subMenu.length>0)) {
                jQuery(subMenu).find("a").eq(0).trigger('click');
            }
        }
        function getUrlVars(url) {
            var vars = [], hash;
            var hashes = url.slice(url.indexOf('?') + 1).split('&');
            for(var i = 0; i < hashes.length; i++) {
                if(hashes.length == 1) {
                    break;
                }
                hash = hashes[i].split('=');
                vars[hash[0]] = hash[1];
            }
            return vars;
        }
        jQuery(document).ready(function() {
            var links;
            var url = document.URL;
            var params = getUrlVars(decodeURIComponent(url));
            
            var openLink = false;
            var iframeVar = params['iframe'];
            iframeVar = (iframeVar==null)?'':iframeVar;
            var iframeParam='';
            for(var i in params) {
                var p = params[i];
                p = (p==null)?'':p;
                if(p != iframeVar) {
                    iframeParam = (iframeParam!='')?iframeParam+'&':'';
                    iframeParam += i+'='+p; 
                }                
            }  
            if(iframeVar != null && iframeVar.toLowerCase() == 'vfdrtsearch') {
                links = [1];
                jQuery('[id$="hiddenIframeParam"]').prop('value',iframeParam);
                openLink = true;
            }
            else if(iframeVar != null && iframeVar.toLowerCase() == 'vfdrtdetail') {           
                jQuery('[id$="hiddenIframeParam"]').prop('value',iframeParam);
                openLink = false;
                OpenPage("DetailDRT");
            }
            else {
                var openSearch = document.getElementById('showSearchDRTLink').value;
                if(openSearch != null && (openSearch.toLowerCase()=='true')) {        
                    OpenPage('SearchDRT');           
                }
            }
            if(openLink) {
               openNode(links);
            }
        });
        
    </script>
</apex:page>