<!-- 
   Type Name:  FV_EditSubPDKPage.page
   Author: Cognizant 
   Created Date: 
   Reason: 
   Change History:
   Author: Dinesh Suggala(Global Foundries)
   Modified Date: 24/8/2017
   Reason: Added the pagination for Table "Select Master PDK Design Spec"
   Author:Dinesh Suggala(Global Foundries)
   Modified Date:18/9/2017
   Reason: Added sorting functionality in pageblocktable and fixed issue in case #00079088
   Author:Dinesh Suggala(Global Foundries)
   Modified Date:3/10/2017
   Reason: Removed sorting functionality in pageblocktable
    -->
<apex:page standardController="Sub_PDK__c" extensions="FV_EditSubPDK" id="pageId">

    <apex:includeScript value="{!URLFOR($Resource.myjQuery, 'js/jquery-1.6.2.min.js')}"/>
    <apex:includeScript value="{!URLFOR($Resource.myjQuery, 'js/jquery-ui-1.8.16.custom.min.js')}"/> 
    <apex:stylesheet value="{!URLFOR($Resource.GF_DQ_JQueryLatest, '/jquery-ui-1.10.3/themes/base/jquery-ui.css')}"/>
    <apex:includeScript value="{!URLFOR($Resource.GF_DQ_jQueryLib, '/jquery.blockUI.js')}"/>
    <apex:includeScript value="https://code.jquery.com/jquery-1.11.0.min.js"/>
    <apex:includeScript value="{!URLFOR($Resource.savebtnDisable, 'savebtnDisable/js/file.js')}"/>  

    
    
    <script type="text/javascript">
            
        $j = jQuery.noConflict();               
		
        $j( window ).ready(function() {
             pageload();
         });         
        function checkAll(checkbox,section)
        {
            $j('.'+section).each(function() {
                  this.checked = checkbox.checked;
            }); 
        }
         function pageload(){
              try{               
                if('{!subPDK.pdk__r.Master_PDK_ASIC__c}' == 'true'){
                     $j(document).ready( function () {
                        $j('option[value="General Release"]').remove();
                        $j('option[value="Specific Account Release"]').remove(); 
                    
                    document.getElementById('pageId:theForm:Pageblockid:Pageblocksectionid:Fieldset:4:Inputfieldid').innerHTML= '<img src="/img/checkbox_checked.gif" alt="Checked" width="21" height="16" class="checkImg" title="Checked">';
                                                                
                        });                    
                 }
              }
              catch(err){
                  alert(err.message);
              }
         } 
        
        function SaveBundle(){
           buttonSaveEdit('enable');
           var status;
           var bundleName = document.getElementById('pageId:theForm:Pageblockid:Pageblocksectionid:Fieldset:1:Inputfieldid').value;
           var releaseStatus = document.getElementById('pageId:theForm:Pageblockid:Pageblocksectionid:Fieldset:0:Inputfieldid').value;

   
           if(releaseStatus == 'General Release')
           {
               var str = 'By selecting Release Status to be General Release, ALL (if any) existing Document Provisioning records will be deleted.';
               if(confirm(str)== false){
                   return false;
              }
              
           }
           if(bundleName != null){
            var regExp = /^[a-zA-Z0-9\-._ ]+$/;
            if(!regExp.test(bundleName)){
                buttonSaveEdit('enable');
                alert('Bundle Name can only contain alphanumeric characters, hyphens(-),underscore(_) and dot(.)');
                return false;                                       
            }       
           }
           if(document.getElementById('pageId:theForm:hiddenId')!=null){
                status = document.getElementById('pageId:theForm:hiddenId').value;
           }
           if (status=='true'){
              $('<div></div>').appendTo('body')
                      .html('<div><h6>You have selected Specification with Internal Release status and that will not be accessible/visible to the customer.<br> Do you want to proceed ?</br></h6></div>')
                      .dialog({
                              modal: true, 
                              title: 'message', 
                              zIndex: 10000, 
                              autoOpen: true,
                              width: 'auto', 
                              resizable: false,
                              buttons: {
                                      Yes: function () {
                                           $.blockUI({ css: { backgroundColor: '##0174DF', color: '#FAFAFA'} }); 
                                            saveSubPDK();
                                            $(this).dialog("close");
                                      },
                                      No: function () {
                                          $(this).dialog("close");
                                      }
                              },
                              close: function (event, ui) {
                                  $(this).remove();
                              }
                    });
               
           } else {
               $.blockUI({ css: { backgroundColor: '##0174DF', color: '#FAFAFA'} }); 
                saveSubPDK();
           } 
        }
        
      //function to unblock the page  
      function unblockPage(){ 
         buttonSaveEdit('enable');  
         $.unblockUI();  
      }
	  
      
    </script>
    <apex:sectionHeader title="PDK Edit" subtitle="Edit PDK"/>  
    
    <apex:form id="theForm">
        <apex:pagemessages id="msg" />
        <apex:actionFunction action="{!saveSubPdk}" name="saveSubPDK" oncomplete="unblockPage()" reRender="msg"/>
        <apex:pageBlock rendered="{!NOT(isReadyForProvisioning)}">
            <apex:pageBlockButtons location="both">
                <apex:commandButton value="Cancel" action="{!cancel}" immediate="true"/>
            </apex:pageBlockButtons>
        </apex:pageBlock>
        <apex:pageBlock mode="detail" title="PDK Edit" rendered="{!isReadyForProvisioning}" id="Pageblockid">
            
            <apex:pageBlockButtons location="both" id="btnpanel">
                <apex:outputPanel id="mainbtn">
                    <apex:outputPanel rendered="{!editpanel}">
                        <apex:commandButton id="bundlesave" onclick="disableButtonEdit(this)" value="Save" action="{!validateStatus}" reRender="hiddenId" oncomplete="return SaveBundle();"/>
                        <!--<apex:commandButton value="Save" action="{!saveSubPdk}" status="SaveStatus" reRender="msg"/>-->
                        <apex:commandButton value="Cancel" action="{!cancel}" immediate="true"/>
                        
                        <apex:actionStatus id="SaveStatus">
                            <apex:facet name="start" >
                                <apex:image url="/img/loading32.gif" height="20px"/>                       
                            </apex:facet>
                        </apex:actionStatus>
                    </apex:outputPanel>
                </apex:outputPanel>
            </apex:pageBlockButtons>
            
            <apex:outputPanel id="editpanel">
                <apex:outputPanel rendered="{!editpanel}">
                    <apex:pageBlockSection title="PDK Information" columns="2" id="Pageblocksectionid">
                    
                        <apex:repeat value="{!$ObjectType.Sub_PDK__c.FieldSets.ReadOnlyFields}" var="f">
                            <apex:outputField value="{!SubPDK[f]}" />                         
                        </apex:repeat>
                        <!--****-->
                       <!--     <apex:selectList Id="genStatId" value="{!selectedGeneralStat}" required="true" size="1" label="{!$ObjectType.Sub_PDK__c.fields.Release_Status__c.label}">
                            <apex:selectOptions value="{!RelStatSeloption}"/>
                            <apex:actionSupport event="onchange" action="{!showWLAccountSection}" reRender="msg,WLAccountPanel,accountsearchClick" status="rsStatus" />
                            </apex:selectList> -->
                        <!--****-->
                        <apex:repeat value="{!$ObjectType.Sub_PDK__c.FieldSets.InputFields}" var="f" id="Fieldset">
                            <apex:inputField value="{!subPDK[f]}" id="Inputfieldid" style="{!IF(((f == 'Description__c' || f =='Special_Instructions_for_PDK_ReleaseTeam__c')), 'width:332px;height:76px;', '')}" rendered="{!IF(NOT(f == 'PDK_Bundle_ASIC__c' && subPDK.pdk__r.Master_PDK_ASIC__c == false ),true,false)}"> <!--required="{!IF(OR(f == 'Name',f == 'Release_Status__c'),true,false)}"> -->  
                                <apex:actionSupport event="onchange" action="{!showWLAccountSection}" reRender="msg,wlpanel,accountsearchClick" status="rsStatus" rendered="{!IF(f == 'Release_Status__c',true,false)}"> 
                            
                                    <apex:actionStatus id="rsStatus">
                                        <apex:facet name="start" >
                                            <apex:image url="/img/loading32.gif" height="20px"/>                       
                                        </apex:facet>
                                    </apex:actionStatus>
                                </apex:actionSupport>
                            </apex:inputField>
                        </apex:repeat>
                        
                        <apex:outputPanel id="accountsearchClick" style="padding-left:20%;">                        
                            <apex:commandLink style="color:green;font-weight:bold;" action="{!clearSearch}" rendered="{!wlpanel}" reRender="editpanel,mainbtn,searchPanel">
                                <apex:image url="/img/icon/accounts16.png"/>
                                Add Account
                            </apex:commandLink>
                             <script>
                             pageload();
                            </script>                                          
                        </apex:outputPanel>
                                        
                    </apex:pageBlockSection>
            
                    <apex:pageBlockSection id="designspecsection" title="Select Master PDK Design Spec" columns="1" >
                    
                        <apex:pageblockTable value="{!showPDKDesignSpec}" var="ds" rendered="{!IF(PDKDesignSpec.size>0,true,false)}" width="90%" >
                            <apex:column >
                            
                                <apex:facet name="header">
                                        <apex:inputcheckbox id="selectAllDesignSpec" onclick="checkAll(this,'DesignSpec')" />
                                    </apex:facet>                                
                            
                                <apex:inputCheckbox value="{!ds.isChecked}" styleClass="DesignSpec"/>
                            </apex:column>
                            
                            <apex:repeat value="{!$ObjectType.Design_Spec__c.FieldSets.SelectDesignSpec}" var="f">
                                <!-- <apex:column value="{!ds.designSpec[f]}"/> -->
                                 <apex:column value="{!ds.designSpec[f]}" rendered="{!IF(NOT(f == 'Specification_ASIC_Flag__c' && subPDK.pdk__r.Master_PDK_ASIC__c== false ),true,false)}" />
                                  
                            </apex:repeat>
        
                        </apex:pageblockTable>
                        <apex:outputLabel value="No records found" rendered="{!!IF(showPDKDesignSpec.size>0,true,false)}"/>
                    
                    </apex:pageBlockSection>
                    
                  <!--- Added Pagination Code By Dinesh 24/8/2017  -->
                    <apex:outputpanel id="panel">
                    <apex:outputLabel value=" Page {!pageNum} of {!totalPages} " />
                     
                     <apex:commandButton value="First" action="{!beginning}" disabled="{!DisablePrevious}" reRender="designspecsection,panel" status="loadingStatus" />
                     <apex:commandButton value="Previous" action="{!previous}" disabled="{!DisablePrevious}" reRender="designspecsection,panel" status="loadingStatus" />
                     <apex:commandButton value="Next" action="{!next}" disabled="{!DisableNext}" reRender="designspecsection,panel" status="loadingStatus" />
                     <apex:commandButton value="Last" action="{!last}" disabled="{!DisableNext}" reRender="designspecsection,panel" status="loadingStatus" />  
                       <apex:actionStatus id="loadingStatus">
                                        <apex:facet name="start" >
                                            <apex:image url="/img/loading32.gif" height="20px"/>                       
                                        </apex:facet>
                       </apex:actionStatus>
                       
                      <apex:outputtext >Total Records :{!PDKDesignSpec.size}</apex:outputtext>
                    </apex:outputPanel>
                   <!--- Code Ended by Dinesh-->
                    <apex:pageBlockSection id="designspecPatchsection" title="Select Master PDK Patch Design Spec" columns="1" >
                        
                        <apex:pageblockTable value="{!patchDesignSpec}" var="ds" rendered="{!IF(patchDesignSpec.size>0,true,false)}" width="90%">
                            <apex:column >
                            
                                <apex:facet name="header">
                                        <apex:inputcheckbox id="selectAllDesignSpec" onclick="checkAll(this,'DesignSpecPatch')" />
                                    </apex:facet>                                
                            
                                <apex:inputCheckbox value="{!ds.isChecked}" styleClass="DesignSpecPatch"/>
                            </apex:column>
                            
                            <apex:repeat value="{!$ObjectType.Design_Spec__c.FieldSets.SelectDesignSpec}" var="f">
                                <apex:column value="{!ds.designSpec[f]}" rendered="{!IF(NOT(f == 'Specification_ASIC_Flag__c' && subPDK.pdk__r.Master_PDK_ASIC__c== false ),true,false)}"/>
                            </apex:repeat> 
                            <apex:column headerValue="Patch Name">
                                <apex:outputText value="{!ds.designSpec.PDK_Patch_Name__c}"/>
                            </apex:column>   
                        </apex:pageblockTable>
                        
                        <apex:outputLabel value="No records found" rendered="{!!IF(patchDesignSpec.size>0,true,false)}"/>
                        
                    </apex:pageBlockSection>
                    
                    <apex:outputPanel id="wlpanel">
                        <apex:pageBlockSection title="White List" columns="1" rendered="{!wlpanel}">
                            <apex:pageblockTable value="{!subPdkWhiteList}" var="wl" rendered="{!IF(subPdkWhiteList.size>0,true,false)}" width="90%">
                                <apex:column >
                                    <apex:facet name="header">
                                        <apex:inputcheckbox id="selectAllWhiteList" onclick="checkAll(this,'WhiteList')" />
                                    </apex:facet>
                                
                                    <apex:inputCheckbox value="{!wl.isChecked}" styleClass="WhiteList"/>
                                </apex:column>
                                
                                <apex:repeat value="{!$ObjectType.Account.FieldSets.WhiteListFields}" var="f">
                                    <apex:column value="{!wl.accountfound[f]}"/>
                                </apex:repeat>
            
                            </apex:pageblockTable>
                            <apex:outputLabel value="No records found" rendered="{!!IF(subPdkWhiteList.size>0,true,false)}"/>
                        </apex:pageBlockSection>
                    </apex:outputPanel>
                    
                </apex:outputPanel>        
            </apex:outputPanel>
            
            
            <apex:outputpanel id="searchPanel">
                <apex:outputPanel rendered="{!searchpanel}">
                    <apex:pageBlockSection title="Search Accounts" columns="1">
                        
                        <apex:outputPanel style="padding-left:30%;padding-top:10%;padding-bottom:10%;">
                                           
                            <apex:inputText value="{!searchString}" styleClass="ui-corner-all"/> &nbsp;&nbsp;&nbsp;                                       
                            <apex:commandButton value="Search" reRender="searchresultpanel,msg" action="{!searchAccount}" status="searchStatus"/>
                            
                            <apex:actionStatus id="searchStatus">
                                <apex:facet name="start" >
                                    <apex:image url="/img/loading32.gif" height="20px"/>                       
                                </apex:facet>
                            </apex:actionStatus>
                            
                        </apex:outputPanel>    
                        
                        
                        <apex:outputPanel id="searchresultpanel">
                            <apex:pageBlockTable value="{!accountSearchList}" var="ac" rendered="{!IF(accountSearchList.size>0,true,false)}">
                                <apex:column >
                                    <apex:inputCheckbox value="{!ac.isChecked}" />
                                </apex:column>
                                
                                <apex:repeat value="{!$ObjectType.Account.FieldSets.WhiteListFields}" var="f">
                                    <apex:column value="{!ac.accountFound[f]}"/>
                                </apex:repeat>
                            </apex:pageBlockTable>
                            
                            <apex:outputLabel value="No records found" rendered="{!!IF(accountSearchList.size>0,true,false)}"/>
                            <br/>
                            <apex:outputPanel rendered="{!IF(accountSearchList.size>0,true,false)}">
                                <apex:commandButton value="Add Selected Accounts" action="{!addSelectedAccounts}" status="addAccountStatus" reRender="theForm" />&nbsp;&nbsp;
                                <apex:commandButton value="Cancel"                action="{!cancelAddAccount}"    status="addAccountStatus" reRender="theForm" />
                            </apex:outputPanel>
                           
                            <apex:actionStatus id="addAccountStatus">
                                <apex:facet name="start" >
                                    <apex:image url="/img/loading32.gif" height="20px"/>                       
                                </apex:facet>
                            </apex:actionStatus>
                            
                        </apex:outputPanel>
                    </apex:pageBlockSection>
                </apex:outputPanel>
            </apex:outputpanel>
        </apex:pageBlock> 
        <apex:inputHidden value="{!isTrue}" id="hiddenId"/> 
    </apex:form>
</apex:page>