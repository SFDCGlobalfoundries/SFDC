<!-- Modifications:
    13-7-17     Inshu Misra     Modified against Issue#462...#IM 
    13-7-17     Abhita Bansal   Modified the code for UAT Issue #434, 435, 436, 438, 439, 442, 458, 459, 460, 464,468, 469, 316
    17-7-17     Inshu Misra     Modified the code for UAT Issue #519, 520, 521, 522
-->
<apex:page standardController="Form_Management_System__c" extensions="FMSRITFormController" showHeader="true" sidebar="true" id="ritPage">
    <apex:includeScript value="{!URLFOR($Resource.jquery, 'js/jquery-1.8.3.min.js')}"/>
    <apex:includeScript value="{!URLFOR($Resource.jquery, 'js/jquery-ui-1.9.2.custom.js')}"/>
    <apex:includeScript value="{!URLFOR($Resource.jqPlugin, '/jquery.blockUI.js')}"/>
    <apex:stylesheet value="{!URLFOR($Resource.jquery, 'css/ui-lightness/jquery-ui-1.9.2.custom.css')}"/>
    <style type="text/css">
        body div{
        font-family: Arial !important;
        }
    </style>
    <style>  
        .bPageBlock .requiredInput .requiredBlock{background-color: #F6FBF6;}  
        .requiredInput .requiredBlock::before { display: block; content: "*"; font-size: 1.5em; font-weight: bold; color: #c00; margin-left: -12px; margin-top: -3px; }  
        p{
        color:brown;
        }
        .brwn{
        padding-top: 42px;
        padding-bottom: 30px;
        color:brown;
        }
        .headerrows {
        background: #8bbec1;
        border-width: 0 0 1px 1px;
        border-color: #8bbec1;
        color: #000;
        font-size: .9em;
        font-weight: bold;
        padding: 5px 2px 4px 5px;
        } 
        .popup {
        background-color: white;
        border-width: 2px;
        border-style: solid;
        z-index: 9999;
        left: 31%;
        padding:10px;
        position: absolute;
        margin-left: -250px;
        top:40px;
        width:1000px;  
        height:650px;     
        }
        .popup1 {
        background-color: white;
        border-width: 2px;
        border-style: solid;
        z-index: 9999;
        left: 45%;
        padding:10px;
        position: absolute;
        margin-left: -250px;
        top:40px;
        width:500px;  
        height:250px;     
        }
        .popupBg {
        background-color:black;
        filter: alpha(opacity = 20);
        position: absolute;
        width: 100%;
        height: 100%;
        top: 0;
        left: 0;
        z-index: 9998;
        }
        .closeButton {
        float: right;
        }
        .message1 {
            display:none;
        }
        .error1 {
            display:none;
        }
        a{
           text-decoration: none;
        }
    </style>
    <script>
        $j = jQuery.noConflict(); 
        //function to block the whole page
        function blockPage(){ 
            $j.blockUI({ message: '<img src="/img/loading32.gif" /><h1> Refreshing...</h1>', 
                css: { 
                 border: 'none', 
                 padding: '15px',  
                 '-webkit-border-radius': '10px', 
                 '-moz-border-radius': '10px', 
                 opacity: .9
                } 
            }); 
            return false;
        }
        //function to unblock the page
        function unblockPage(){
            $j.unblockUI();
        }
    
        
    </script>
    <script>
        function launchPrintWindow(formObjId){
            window.open("/apex/FMSRITFormViewPrintPDF?id="+formObjId);
        }        
        
        function pickselectedVal(){
            var e = document.getElementById("createAddOpt");
            var str = e.options[e.selectedIndex].value;
            console.log('Value selected - '+str);
            if(str==' '){
                $j('.error1').show();
            }else{
                $j('.error1').hide();
                createAddendumFunction(str);
            }
        }
        function showMessageDDR(){
            $j = jQuery.noConflict();    
            var e = document.getElementById("createAddOpt");
            var str = e.options[e.selectedIndex].value;
            if(str == 'RIT'){               
                $j('.message1').show();
            }else{
                $j('.message1').hide();
            }
        }        
    </script>
    <apex:outputPanel id="addendumpnl">
    <script>
        function showDialogforActions(actionName){      
            var sd = new SimpleDialog("Test"+Dialogs.getNextId(), true);    
            sd.setTitle("Warning");   
            sd.createDialog(); 
            sd.setWidth(400);               
            window.parent.sd = sd;
            if(actionName == 'SubmitForm'){
                var strSubmit = "<img src='/img/msg_icons/warning24.png'/> <b>Warning!</b> <br/><br/>Are you sure you want to complete this form action? <br/> <br/> Submitting this form signifies that you are ready for your design data to begin processing. Please ensure the accuracy of your responses in the form, as the processing will begin automatically. <br/><br/><p align='center'><button class='btn' onclick='submitFormFuntion(); window.parent.sd.hide(); return true;'>Continue</button>&nbsp; &nbsp; &nbsp; &nbsp; <button class='btn' onclick='window.parent.sd.hide(); return false;'>Cancel</button></p>";
                console.log(strSubmit);             
                var ex = sd.setContentInnerHTML(strSubmit); 
                sd.show();   
                return ex;
            }
            else if(actionName == 'HoldRTMforClientDecision'){
                var strSubmit = "<img src='/img/msg_icons/warning24.png'/> <b>Warning!</b> <br/><br/>Are you sure you want to complete this form action? <br/> <br/> Hold the design data processing associated with this form for a client decision. A target date for release to the mask house (RTM) will not be provided until the hold is removed. <br/><br/><p align='center'><button class='btn' onclick='window.parent.sd.hide(); submitFormActionFuntion(\""+actionName+"\"); return true;'>Continue</button>&nbsp; &nbsp; &nbsp; &nbsp; <button class='btn' onclick='window.parent.sd.hide(); return false;'>Cancel</button></p>";
                console.log(strSubmit);             
                var ex = sd.setContentInnerHTML(strSubmit); 
                sd.show();   
                return ex;
            }else if(actionName == 'Returned'){
                var strSubmit = "<img src='/img/msg_icons/warning24.png'/> <b>Warning!</b> <br/><br/>Are you sure you want to complete this form action? <br/> <br/> Return this form to the client to enable updates.<br/><br/><p align='center'><button class='btn' onclick='window.parent.sd.hide(); submitFormActionFuntion(\""+actionName+"\"); return true;'>Continue</button>&nbsp; &nbsp; &nbsp; &nbsp; <button class='btn' onclick='window.parent.sd.hide(); return false;'>Cancel</button></p>";
                console.log(strSubmit);             
                var ex = sd.setContentInnerHTML(strSubmit); 
                sd.show();   
                return ex;
            }else if(actionName == 'RTMProceed'){
                var strSubmit = "<img src='/img/msg_icons/warning24.png'/> <b>Warning!</b> <br/><br/>Are you sure you want to complete this form action? <br/> <br/> Proceed with the design data processing associated with this form in preparation for mask build (RTM).<br/><br/><p align='center'><button class='btn' onclick='window.parent.sd.hide(); submitFormActionFuntion(\""+actionName+"\"); return true;'>Continue</button>&nbsp; &nbsp; &nbsp; &nbsp; <button class='btn' onclick='window.parent.sd.hide(); return false;'>Cancel</button></p>";
                console.log(strSubmit);             
                var ex = sd.setContentInnerHTML(strSubmit); 
                sd.show();   
                return ex;
            }else if(actionName == 'Cancelled'){
                var strSubmit = "<img src='/img/msg_icons/warning24.png'/> <b>Warning!</b> <br/><br/>Are you sure you want to complete this form action? <br/> <br/> Cancels the design submission related to this form.<br/><br/><p align='center'><button class='btn' onclick='window.parent.sd.hide(); submitFormActionFuntion(\""+actionName+"\"); return true;'>Continue</button>&nbsp; &nbsp; &nbsp; &nbsp; <button class='btn' onclick='window.parent.sd.hide(); return false;'>Cancel</button></p>";
                console.log(strSubmit);             
                var ex = sd.setContentInnerHTML(strSubmit); 
                sd.show();   
                return ex;
            }else if(actionName == 'RTMComplete'){
                var strSubmit = "<img src='/img/msg_icons/warning24.png'/> <b>Warning!</b> <br/><br/>Are you sure you want to complete this form action? <br/> <br/> The design data processing associated with this form has been completed and released to the mask house (RTM) for mask build. <br/><br/> <p align='center'><button class='btn' onclick='window.parent.sd.hide(); submitFormActionFuntion(\""+actionName+"\"); return true;'>Continue</button>&nbsp; &nbsp; &nbsp; &nbsp; <button class='btn' onclick='window.parent.sd.hide(); return false;'>Cancel</button></p>";
                console.log(strSubmit);             
                var ex = sd.setContentInnerHTML(strSubmit); 
                sd.show();   
                return ex;
            }else if(actionName == 'PreliminaryComplete'){
                var strSubmit = "<img src='/img/msg_icons/warning24.png'/> <b>Warning!</b> <br/><br/>Are you sure you want to complete this form action? <br/> <br/> The preliminary design data processing has begun.<br/><br/> <p align='center'><button class='btn' onclick='window.parent.sd.hide(); submitFormActionFuntion(\""+actionName+"\"); return true;'>Continue</button>&nbsp; &nbsp; &nbsp; &nbsp; <button class='btn' onclick='window.parent.sd.hide(); return false;'>Cancel</button></p>";
                console.log(strSubmit);             
                var ex = sd.setContentInnerHTML(strSubmit); 
                sd.show();   
                return ex;
            }
        }
        function holdforRTMFormActionFuntion(toFormState){
            var sd = new SimpleDialog("Test"+Dialogs.getNextId(), true);    
            sd.setTitle("FMS \'Form State\' Change");   
            sd.createDialog();   
            sd.setWidth(600); 
            window.parent.sd = sd;
            if('{!formObj.State_of_the_Form__c}' == 'ProceedToRTM' && toFormState == 'HoldRTMforClientDecision'){    
                paraFunction(toFormState);
            }else if(('{!formObj.State_of_the_Form__c}' == 'HoldRTMforClientDecision' || '{!formObj.State_of_the_Form__c}' == 'Returned') && toFormState == 'Cancelled'){
                paraFunction(toFormState);
            }else if('{!formObj.State_of_the_Form__c}' == 'Cancelled' && toFormState == 'Returned'){
                paraFunction(toFormState);
            }
        }
        
        //Start Bug489-Anil Kumar Reddy - Modified delete popup
        function showDialogforDelete(){
            var sd = new SimpleDialog("Test"+Dialogs.getNextId(), true);    
            sd.setTitle("Warning");   
            sd.createDialog(); 
            sd.setWidth(400);               
            window.parent.sd = sd;
            var ex = sd.setContentInnerHTML("<img src='/img/msg_icons/warning24.png'/> <b>Warning!</b> <br/><br/>Are you sure you want to delete this form? <br/><br/> <b>The form will no longer be retrievable once deleted.</b> <br/><br/> Note: The form delete operation may take 1-2 minutes to complete. Please do not perform any other operations during this time. We appreciate your patience. <br/><br/><p align='center'><button class='btn' onclick='DeleteFormActionFunction(); window.parent.sd.hide(); return true;'>Confirm</button>&nbsp; &nbsp; &nbsp; &nbsp; <button class='btn' onclick='window.parent.sd.hide(); return false;'>Cancel</button></p>"); 
            sd.show();   
            return ex;
        }
        //End Bug489-Anil Kumar Reddy - Modified delete popup
        
    </script>
    </apex:outputPanel>     
    <apex:form id="fmsForm">
        <apex:pagemessages id="errorMsg" />
        <c:FMSNameDesc ></c:FMSNameDesc>
        <c:FMSHierarchy formId="{!formId}"></c:FMSHierarchy>
    
        <apex:actionFunction name="createAddendumFunction" action="{!continueCheck}" reRender="fmsForm" status="blockUI">
            <apex:param id="addenId" name="addenType" value="" />
        </apex:actionFunction>
        
        <apex:actionFunction name="submitFormActionFuntion" action="{!statusChange}" reRender="" status="blockUI">
            <apex:param id="stateChangeId" name="stateValue" value="" />
        </apex:actionFunction>
        
        <apex:actionFunction name="submitFormFuntion" action="{!submitForm}" status="blockUI"/>       
        
        <apex:actionFunction name="validaCheck" action="{!validationBeforeAddendum}" reRender="errorMsg,addendumpnl" status="blockUI">
            <apex:param id="validateCheckId" name="stateChangeVal" value=""/>
        </apex:actionFunction>
        
        <apex:actionFunction name="paraFunction" action="{!showPopup}" reRender="fmsForm,mainPgBlock">
            <apex:param id="state" name="stateVal" value="" />
        </apex:actionFunction>
        
        <apex:actionFunction name="changeStatus" action="{!statusChange}" reRender="ritPage">
            <apex:param id="aname" name="stateValue" value="" />
        </apex:actionFunction>
        
        <apex:actionFunction name="DeleteFormActionFunction" action="{!deleteForm}" status="blockUI"/>       

        <apex:actionStatus onstart="blockPage()" onstop="unblockPage()" id="blockUI"/>
        
        <apex:pageblock id="mainPgBlock" >
            
            <apex:pageBlock title="FMS 'Form State' Change" rendered="{!popupVal}">
                <apex:pageblockSection columns="1">
                    <apex:pageBlockSectionItem >
                        <apex:outputLabel value="Current Form State: "/>
                        <apex:outputField value="{!formObj.State_of_the_Form__c}"/>
                    </apex:pageblockSectionItem>
                    <apex:pageBlockSectionItem >
                        <apex:outputLabel value="Changing to Form State: "/>
                        <apex:outputText value="{!requestMsg}"/>
                    </apex:pageblockSectionItem>
                    <apex:outputPanel rendered="{!requestMsg == 'HoldRTMforClientDecision'}">
                        <p style="color:black;margin-left: 10px">Please Note: Hold the design data processing associated with this form for a client decision. A target date for release to the mask house (RTM) will not be provided until the hold is removed.</p>
                    </apex:outputPanel>
                    <apex:outputPanel rendered="{!requestMsg == 'Cancelled'}">
                        <p style="color:black;margin-left: 10px">Please Note: Cancels the design submission related to this form.</p>
                    </apex:outputPanel>
                    <apex:outputPanel rendered="{!requestMsg == 'Returned'}">
                        <p style="color:black;margin-left: 10px">Please Note: Return this form to the client to enable updates.</p>
                    </apex:outputPanel>
                    <apex:pageblockSection columns="1">
                        <apex:outputLabel value="Please provide a brief description explaining the reason for this action:" style="font-weight:bold;">
                            <span style="display: inline; font-size: 1.5em; font-weight: bold; color: #c00; position: relative;">&nbsp;*</span>
                        </apex:outputLabel>
                    </apex:pageblocksection>
                    <apex:outputPanel >
                        <apex:inputTextarea value="{!stateChangeComments}" style="height:150px; width:600px;" html-maxlength="500"/>
                    </apex:outputPanel>
                </apex:pageblockSection>
                &nbsp;&nbsp;&nbsp;&nbsp;
                <apex:commandButton value="Continue" action="{!continueCheck}" rerender="fmsForm, errorMsg" oncomplete="window.scrollTo(0,0);" status="blockUI"/>
                &nbsp;&nbsp;&nbsp;
                <apex:commandButton value="Cancel" action="{!closePopup}" immediate="true" rerender="fmsForm" status="blockUI"/>        
            </apex:pageBlock>
            <apex:pageBlock title="Possible form Actions" rendered="{! !popupVal}">
                
                <apex:outputLabel style="font-style:italic;font-size:10pt;"> 
                    The selected form may have one or more action paths available to you based on your granted permissions and the current state of the form. 
                    Select the desired action to trigger that action, or select the Back to form select button to return to the form selection page
                </apex:outputLabel>
                <br/> <br/>
                
                <apex:outputPanel >
                    <apex:pageblockSection columns="1">
                        <apex:outputField value="{!formObj.State_of_the_Form__c}" Label="Current Form State:"/>
                        <apex:outputField value="{!formObj.Mandatory_State_Change_Comments__c}" label="Reason for State Change:" rendered="{!((formObj.State_of_the_Form__c == 'Cancelled' && (formObj.Previous_State_Of_Form__c == 'HoldRTMforClientDecision' || formObj.Previous_State_Of_Form__c == 'Returned')) || (formObj.State_of_the_Form__c == 'HoldRTMforClientDecision' && formObj.Previous_State_Of_Form__c == 'ProceedToRTM') || (formObj.State_of_the_Form__c == 'Returned' && formObj.Previous_State_Of_Form__c == 'Cancelled')) && (formObj.Mandatory_State_Change_Comments__c != null && formObj.Mandatory_State_Change_Comments__c != '')}"/>
                    </apex:pageblockSection>
                    <br/>
                    <apex:outputPanel >
                        <html>
                            <table class="list" style="width:1030px">
                                <tr class="headerRow" align="center">
                                    <td style="font-size: 8pt;width:200px">Action</td>
                                    <td style="font-size: 8pt;">Description</td>
                                </tr>
                                
                                <apex:variable rendered="{!((isFMSAdmin  && (formObj.State_of_the_Form__c == 'SubmitToProcess' || formObj.State_of_the_Form__c == 'ProceedToRTM' || formObj.State_of_the_Form__c == 'RTMComplete' || formObj.State_of_the_Form__c == 'PreliminaryRequestAccepted')) ||  (formObj.State_of_the_Form__c == 'HoldRTMforClientDecision') || (formObj.State_of_the_Form__c == 'Returned'))}" value="" var="v">
                                    <tr class="datarow">
                                        <td class="datacell">
                                            <apex:commandLink style="width:120px;color:blue;" onclick="window.scrollTo(0,0);" oncomplete="showDialogforActions('Cancelled');" rendered="{!formObj.State_of_the_Form__c != 'HoldRTMforClientDecision' && formObj.State_of_the_Form__c != 'Returned'}">Cancel design submission</apex:commandLink>
                                            <apex:commandLink style="width:120px;color:blue;" onclick="window.scrollTo(0,0); holdforRTMFormActionFuntion('Cancelled'); return false;" rendered="{!formObj.State_of_the_Form__c == 'HoldRTMforClientDecision' || formObj.State_of_the_Form__c == 'Returned'}">Cancel design submission</apex:commandLink>
                                        </td>
                                        <td class="datacell">
                                            <apex:outputLabel >
                                                Cancels the design submission related to this form.
                                            </apex:outputLabel>
                                        </td>
                                    </tr>
                                </apex:variable>
                                <apex:variable rendered="{!((isFMSAdmin && (formObj.State_of_the_Form__c == 'SubmitToProcess' || formObj.State_of_the_Form__c == 'Returned') && formObj.SubmissionType__c == 'Final Submission' && formObj.RitHold__c == 'No') || (formObj.State_of_the_Form__c == 'HoldRTMforClientDecision'))}" value="" var="v">
                                    <tr class="datarow">
                                        <td class="datacell">
                                            <apex:commandLink style="width:120px;color:blue;" onclick="window.scrollTo(0,0);" oncomplete="showDialogforActions('RTMProceed');">Proceed to RTM</apex:commandLink>
                                        </td>
                                        <td class="datacell">
                                            <apex:outputLabel >
                                                Proceed with the design data processing associated with this form in preparation for mask build (RTM).
                                            </apex:outputLabel>
                                        </td>
                                    </tr>
                                </apex:variable>
                                <apex:variable rendered="{!((isFMSAdmin && (formObj.State_of_the_Form__c == 'SubmitToProcess' || formObj.State_of_the_Form__c == 'Returned') && formObj.SubmissionType__c == 'Final Submission' && formObj.RitHold__c ==  'Yes') || (formObj.State_of_the_Form__c == 'ProceedToRTM'))}" value="" var="v">
                                    <tr class="datarow">
                                        <td class="datacell">
                                            <apex:commandLink style="width:120px;color:blue;" onclick="window.scrollTo(0,0);" oncomplete="showDialogforActions('HoldRTMforClientDecision');" rendered="{!formObj.State_of_the_Form__c != 'ProceedToRTM'}">Hold RTM for client decision</apex:commandLink>
                                            <apex:commandLink style="width:120px;color:blue;" onclick="window.scrollTo(0,0); holdforRTMFormActionFuntion('HoldRTMforClientDecision');return false;" rendered="{!formObj.State_of_the_Form__c == 'ProceedToRTM'}">Hold RTM for client decision</apex:commandLink>
                                        </td>
                                        <td class="datacell">
                                            <apex:outputLabel >
                                                Hold the design data processing associated with this form for a client decision. A target date for release to the mask house (RTM) will
                                                not be provided until the hold is removed.
                                            </apex:outputLabel>
                                        </td>
                                    </tr>
                                </apex:variable>
                                <apex:variable rendered="{!(isFMSAdmin && (formObj.State_of_the_Form__c == 'SubmitToProcess' || formObj.State_of_the_Form__c == 'Returned') && formObj.SubmissionType__c != 'Final Submission' )}" value="" var="v">
                                    <tr class="datarow">
                                        <td class="datacell">
                                            <apex:commandLink style="width:120px;color:blue;" onclick="window.scrollTo(0,0);" oncomplete="showDialogforActions('PreliminaryComplete');">Preliminary design processing accepted</apex:commandLink>
                                        </td>
                                        <td class="datacell">
                                            <apex:outputLabel >
                                                The preliminary design data processing has begun.
                                            </apex:outputLabel>
                                        </td>
                                    </tr>
                                </apex:variable>                                
                                <apex:variable rendered="{!((isFMSAdmin && (formObj.State_of_the_Form__c == 'SubmitToProcess' || formObj.State_of_the_Form__c == 'HoldRTMforClientDecision' || formObj.State_of_the_Form__c == 'ProceedToRTM' || formObj.State_of_the_Form__c == 'PreliminaryRequestAccepted' || formObj.State_of_the_Form__c == 'RTMComplete')) || ((!isPortalUser || isFMSAdmin) && formObj.State_of_the_Form__c == 'Cancelled'))}" value="" var="v">
                                    <tr class="datarow">
                                        <td class="datacell">                      
                                            <apex:commandLink style="width:120px;color:blue;" onclick="window.scrollTo(0,0);" oncomplete="showDialogforActions('Returned');" rendered="{!formObj.State_of_the_Form__c != 'Cancelled'}">Return for update</apex:commandLink>
                                            <apex:commandLink style="width:120px;color:blue;" onclick="window.scrollTo(0,0); holdforRTMFormActionFuntion('Returned'); return false;" rendered="{!formObj.State_of_the_Form__c == 'Cancelled'}">Return for update</apex:commandLink>
                                        </td>
                                        <td class="datacell">
                                            <apex:outputLabel >
                                                Return this form to the client to enable updates.
                                            </apex:outputLabel>
                                        </td>
                                    </tr>
                                </apex:variable>
                                <apex:variable rendered="{!(isFMSAdmin && ((formObj.SubmissionType__c == 'Final Submission' && formObj.RitHold__c ==  'No' && formObj.State_of_the_Form__c == 'Returned') || (formObj.State_of_the_Form__c == 'ProceedToRTM')))}" value="" var="v">
                                    <tr class="datarow">
                                        <td class="datacell">
                                            <apex:commandLink style="width:120px;color:blue;" onclick="window.scrollTo(0,0);" oncomplete="showDialogforActions('RTMComplete');">RTM complete</apex:commandLink>
                                        </td>
                                        <td class="datacell">
                                            <apex:outputLabel >
                                                The design data processing associated with this form has been completed and released to the mask house (RTM) for mask build.
                                            </apex:outputLabel>
                                        </td>
                                    </tr>
                                </apex:variable>
                                <apex:variable rendered="{!((formObj.State_of_the_Form__c == 'Draft' || formObj.State_of_the_Form__c == 'Returned') && (formObj.ReleaseAutomationTraining__c == 'Yes' && (( ((formObj.SubmissionType__c == 'Final Submission' && formObj.Parent_Form_Id__r.State_of_the_Form__c == 'Frozen' && formObj.Main_Form_Id__r.State_of_the_Form__c == 'Frozen') || formObj.SubmissionType__c == 'Preliminary - Checking Only' || formObj.SubmissionType__c == 'Preliminary - Checking and Design Services')) || ( (formObj.SubmissionType__c == 'Preliminary - Design Services only' || formObj.SubmissionType__c == 'Preliminary - Features Extraction Report')))))}" value="" var="v"> 
                                    <tr class="datarow">
                                        <td class="datacell">
                                            <apex:commandLink style="width:120px;color:blue;" onclick="showDialogforActions('SubmitForm'); window.scrollTo(0,0);return false;">Submit for design processing</apex:commandLink>
                                        </td>
                                        <td class="datacell">
                                            <apex:outputLabel >
                                                Submitting this form signifies that you are ready for your design data to begin processing.  
                                                Please ensure the accuracy of your responses in the form, as the processing will begin automatically.
                                            </apex:outputLabel>
                                        </td>
                                    </tr>
                                </apex:variable>
                                <apex:variable rendered="{! (formObj.State_of_the_Form__c == 'SubmitToProcess' || formObj.State_of_the_Form__c == 'HoldRTMforClientDecision' || formObj.State_of_the_Form__c == 'ProceedToRTM' || formObj.State_of_the_Form__c == 'RTMComplete') && formObj.SubmissionType__c == 'Final Submission'}" value="" var="v">
                                    <tr class="datarow">
                                        <td class="datacell">                                           
                                            <apex:commandLink style="width:120px;color:blue;" action="{!createAddendumForm}">Create Addendum Form</apex:commandLink>
                                        </td>
                                        <td class="datacell">
                                            <apex:outputLabel >
                                                Create a new addendum form.
                                            </apex:outputLabel>
                                        </td>
                                    </tr>
                                </apex:variable> 
                                <apex:variable value="" var="v">
                                    <tr class="datarow">
                                        <td class="datacell">
                                            <apex:commandLink style="width:120px;color:blue;" action="{!copyAsNewForm}">Copy as new form</apex:commandLink>
                                        </td>
                                        <td class="datacell">
                                            <apex:outputLabel >
                                                This feature allows you to copy the values from this existing form into a new form. The new form may be created on an updated template from the old form. It is therefore not guaranteed that 100% of the values will copy. You must still review the new form entirely before submitting.
                                            </apex:outputLabel>
                                        </td>
                                    </tr>
                                </apex:variable>   
                                <tr class="datarow">
                                  <td class="datacell">                          
                                  <apex:commandLink style="width:120px;color:blue;" action="{!chngHistory}" target="_blank">Browse change history</apex:commandLink>
                                  </td>
                                  
                                  <td class="datacell">
                                  <apex:outputLabel >
                                  Browse the change history for this form.
                                  </apex:outputLabel>
                                  </td>
                                  </tr>                             
                                <apex:variable rendered="{!!subscribeFlag}" value="" var="v">
                                    <tr class="datarow">
                                        <td class="datacell">
                                            <apex:commandLink style="width:120px;color:blue;" action="{!Subscribe}">Subscribe to this form</apex:commandLink>
                                        </td>
                                        <td class="datacell">
                                            <apex:outputLabel >
                                                Subscribe to receive email notification for all events for this specific form.
                                            </apex:outputLabel>
                                        </td>
                                    </tr>
                                </apex:variable>
                                <apex:variable rendered="{!subscribeFlag}" value="" var="v">
                                    <tr class="datarow">
                                        <td class="datacell">
                                            <apex:commandLink style="width:120px;color:blue;" action="{!UnSubscribe}">Unsubscribe from this form</apex:commandLink>
                                        </td>
                                        <td class="datacell">
                                            <apex:outputLabel >
                                                Remove your existing individual subscription for this form.
                                            </apex:outputLabel>
                                        </td>
                                    </tr>
                                </apex:variable>
                                <apex:variable value="" var="v" rendered="{!((formObj.State_of_the_Form__c == 'Draft') || (formObj.State_of_the_Form__c == 'Returned' && (isFMSAdmin || isPortalUser)))}" >
                                    <tr class="datarow">
                                        <td class="datacell">
                                            <apex:commandLink style="width:120px;color:blue;" action="{!SubscribeUser}">Subscribe other users to this form</apex:commandLink>
                                        </td>
                                        <td class="datacell">
                                            <apex:outputLabel >
                                                Subscribe other users to receive email notifications for all events for this specific form.
                                            </apex:outputLabel>
                                        </td>
                                    </tr>
                                </apex:variable>
                                <apex:variable rendered="{!((formObj.State_of_the_Form__c == 'Draft') || (formObj.State_of_the_Form__c == 'Returned' && (isFMSAdmin || isPortalUser)))}" value="" var="v">
                                    <tr class="datarow">
                                        <td class="datacell">
                                            <apex:commandLink style="width:120px;color:blue;" action="{!editForm}">Edit</apex:commandLink>
                                        </td>
                                        <td class="datacell">
                                            <apex:outputLabel >
                                                Edit the Form.
                                            </apex:outputLabel>
                                        </td>
                                    </tr>
                                </apex:variable>
                                <apex:variable rendered="{!(formObj.State_of_the_Form__c == 'Draft' || (formObj.State_of_the_Form__c == 'Returned' && (isFMSAdmin || isPortalUser)))}" value="" var="v">
                                    <tr class="datarow">
                                        <td class="datacell">
                                            <apex:commandLink style="width:120px;color:blue;" action="{!updateFormDetails}">Update form details</apex:commandLink>
                                        </td>
                                        <td class="datacell">
                                            <apex:outputLabel >
                                                Modify the form name and description.
                                            </apex:outputLabel>
                                        </td>
                                    </tr>
                                </apex:variable>                               
                                <!--<apex:variable rendered="{!(formObj.State_of_the_Form__c == 'Draft' || ((formObj.State_of_the_Form__c == 'Returned' || formObj.State_of_the_Form__c == 'Cancelled' || formObj.State_of_the_Form__c == 'Draft') && isFMSAdmin))}" value="" var="v">
                                    <tr class="datarow">
                                        <td class="datacell">                                           
                                            <apex:commandLink style="width:120px;color:blue;" onclick="showDialogforDelete(); window.scrollTo(0,0); return false;">Delete Form</apex:commandLink>
                                        </td>
                                        <td class="datacell">
                                            <apex:outputLabel >
                                                Delete the form from the system. The form will no longer be retrievable once deleted.
                                            </apex:outputLabel>
                                        </td>
                                    </tr>
                                </apex:variable>-->
                            </table>
                        </html>
                    </apex:outputPanel>
                </apex:outputPanel>
            </apex:pageBlock>
            <br/>
            &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
            <apex:outputPanel rendered="{!!popupVal}">
            <h1>View Form Data</h1>
            </apex:outputPanel>
            <br/>

            <apex:pageBlock title="Form Page 1" id="pb1" rendered="{!!popupVal}">
                <h1>
                    Foundry Design Data Submission Form
                </h1>
                <p style="color:black;">
                    This form provides key data to the Foundry Release Team in order to begin data processing from data
                    submitted through the GLOBALFOUNDRIES dropbox.
                </p>
                <br/>
                <apex:pageblockSection title="Prerequisites" columns="1" id="pbs1" collapsible="false">
                    <apex:actionRegion >
                        <apex:outputPanel >
                            <apex:pageBlockSection >
                                <apex:pageblocksectionItem >
                                    <apex:outputlabel value="Have you read and do you understand the Design Data Submission (Tapeout) Process Education Package?"/>
                                    <apex:outputPanel >
                                        <div class = "requiredInput">
                                            <div class = "requiredBlock"></div>
                                            <apex:outputField value="{!formObj.ReleaseAutomationTraining__c}" />
                                        </div> 
                                    </apex:outputPanel>
                                </apex:pageblocksectionItem>
                            </apex:pageBlockSection>
                        </apex:outputPanel>
                        
                        <apex:outputPanel id="releaseAuto">
                            <apex:outputPanel rendered="{!(formObj.ReleaseAutomationTraining__c == 'No')}" >
                                <p> You answered "no" that you have not received or understood the Release Automation Training
                                    Package. This training package is critical to a successful automation. Please download and review it
                                    before continuing. You can save this form, review the training package, and change your answer to "yes" when ready. Thank you.
                                </p>
                            </apex:outputPanel>
                        </apex:outputPanel>
                        
                        <apex:outputPanel id="automationTrngpnl">
                            <br/>
                            <apex:outputLink style="margin-left:320px;color:blue;" value="{!FMSdocuments['ReleaseAutomationTraining']}" id="theLink">Link to Data Submission (Tapeout) Training</apex:outputLink>
                            <br/><br/>
                        </apex:outputPanel>
                        
                       
                        <apex:outputPanel >
                            <apex:pageBlockSection >
                                <apex:pageblocksectionItem rendered="{!(formObj.Parent_Form_Id__r.Waivers__c == 'Yes')}">
                                    <apex:outputLabel value="You answered in your parent form that you will require waivers for DRC violations. Have you submitted requests for all waivers to your Foundry Technical Representative?"/>
                                    <apex:outputPanel >
                                        <div class = "requiredInput">
                                            <div class = "requiredBlock"></div>
                                            <apex:outputField value="{!formObj.Waivers__c}" />
                                        </div>
                                    </apex:outputPanel>
                                </apex:pageblocksectionItem>
                            </apex:pageBlockSection>
                        </apex:outputPanel>
                        
                        <apex:outputPanel id="waiver">
                            <apex:outputPanel rendered="{!(AND(formObj.Waivers__c == 'No',formObj.Parent_Form_Id__r.Waivers__c == 'Yes'))}" >
                                <p>
                                    Waiver requests must be submitted to your Foundry Technical Representative at least 8 business days prior to tapeout to prevent delays. 
                                    Please submit your waiver requests as soon as possible.
                                </p>
                            </apex:outputPanel>
                        </apex:outputPanel>
                    </apex:actionRegion>
                </apex:pageBlockSection>
                
                <apex:pageBlockSection title="General Information" columns="1" id="pbs2" collapsible="false">
                    <apex:actionRegion >
                        <apex:outputPanel >
                            <apex:pageblockSection columns="1">
                                <apex:outputField value="{!formObj.RITProductName__c}" id="prodName" label="Product Name:" />
                                <apex:outputField value="{!formObj.Parent_Form_Id__r.ProductRevision__c}" id="productRev" label="Product Revision:" />
                                <apex:outputField value="{!formObj.Main_Form_Id__r.Technology__c}" id="tech" label="Technology:" />
                                <apex:outputField value="{!formObj.Main_Form_Id__r.ItarData__c}" id="ITRAdata" label="Does this product fall under the International Traffic in Arms Regulations (ITAR)?" />
                                <apex:outputField value="{!formObj.Main_Form_Id__r.ReleaseProcessFlow__c}" id="releasepro" label="Release Process:" />
                            </apex:pageblockSection>
                        </apex:outputPanel>
                        
                                                <apex:outputPanel >
                            <apex:pageblockSection >
                                <apex:pageblocksectionItem rendered="{!(formObj.Parent_Form_Id__r.ReleaseProcessFlow__c == 'Enhanced Flow' && (soldTo != null && soldTo != '' && (contains('0000008944',soldTo)|| contains('0000012768',soldTo))))}">
                                    <apex:outputLabel value="Is a purge map for features extraction required?"/>
                                    <apex:outputPanel >
                                        <div class = "requiredInput">
                                            <div class = "requiredBlock"></div>
                                            <apex:outputField value="{!formObj.IsPurge__c}" />
                                        </div>
                                    </apex:outputPanel>
                                </apex:pageblocksectionItem>
                            </apex:pageblockSection>
                        </apex:outputPanel>
                    
                        <apex:outputPanel id="purgeMapFile">
                            <apex:pageBlockSection >
                                <apex:pageblocksectionItem rendered="{!(AND(formObj.Main_Form_Id__r.ReleaseProcessFlow__c == 'Enhanced Flow', formObj.IsPurge__c == 'Yes', (soldTo != null && soldTo != '' && (contains('0000008944',soldTo)|| contains('0000012768',soldTo)))))}">
                                    <apex:outputLabel value="List purge mapfile name included in package:"/>
                                    <apex:outputPanel >
                                        <div class = "requiredInput">
                                            <div class = "requiredBlock"></div>
                                            <apex:outputField value="{!formObj.PurgeMapFile__c}" />
                                        </div>
                                    </apex:outputPanel>
                                </apex:pageblocksectionItem>
                            </apex:pageBlockSection>
                        </apex:outputPanel>
                    
                        <apex:outputPanel >
                            <apex:pageblockSection >
                                <apex:pageblocksectionItem >
                                    <apex:outputLabel value="Type of Data Submission:"/>
                                    <apex:outputPanel >
                                        <div class = "requiredInput">
                                            <div class = "requiredBlock"></div>
                                            <apex:outputField value="{!formObj.SubmissionType__c}" />
                                        </div>
                                    </apex:outputPanel>
                                </apex:pageblocksectionItem>
                            </apex:pageblockSection>
                        </apex:outputPanel>
                        
                        <apex:outputPanel id="SubType">
                            <apex:outputPanel rendered="{!(formObj.SubmissionType__c == 'Final Submission')}" >
                                <apex:outputText value="{!SubmssnMessg}" styleClass="brwn" ></apex:outputText>
                            </apex:outputPanel>
                            <apex:outputPanel rendered="{!(formObj.SubmissionType__c == 'Preliminary - Checking Only')}" >
                                <apex:outputText value="{!SubmssnMessg}" styleClass="brwn" ></apex:outputText>
                            </apex:outputPanel>
                            <apex:outputPanel rendered="{!(formObj.SubmissionType__c == 'Preliminary - Checking and Design Services')}" >
                                <apex:outputText value="{!SubmssnMessg}" styleClass="brwn" ></apex:outputText>
                            </apex:outputPanel>
                            <apex:outputPanel rendered="{!(formObj.SubmissionType__c == 'Preliminary - Design Services only')}" >
                                <apex:outputText value="{!SubmssnMessg}" styleClass="brwn" ></apex:outputText>
                            </apex:outputPanel>
                        </apex:outputPanel>
                        <apex:outputPanel >
                            <apex:pageblockSection >
                                <apex:pageblocksectionItem rendered="{!(formObj.Main_Form_Id__r.ReleaseProcessFlow__c == 'Enhanced Flow' && soldTo != null && soldTo != '' && (contains('0000008944',soldTo)|| contains('0000012768',soldTo)))}">
                                    <apex:outputLabel value="Check here if you want a features extraction report from this design data submission:"/>
                                    <apex:outputPanel >
                                        <apex:outputField value="{!formObj.ExtractionReport__c}" />
                                    </apex:outputPanel>
                                </apex:pageblocksectionItem>
                            </apex:pageblockSection>
                            <apex:outputPanel rendered="{!selExtMessage}">
                                <p>
                                    This selection will trigger the return of an individual technology Features Extraction report for each submitted GDS file.
                                </p>
                                <br/>
                            </apex:outputPanel>
                            
                        </apex:outputPanel>

                        <apex:outputPanel id="purchaseOrder">
                            <apex:pageBlockSection >
                                <apex:pageblocksectionItem rendered="{!(formObj.SubmissionType__c == 'Final Submission')}">
                                    <apex:outputLabel value="Has a Purchase Order been submitted to support this final data submission?"/>
                                    <apex:outputPanel >
                                        <div class = "requiredInput">
                                            <div class = "requiredBlock"></div>
                                            <apex:outputField value="{!formObj.PurchaseOrder__c}" />
                                        </div>
                                    </apex:outputPanel>
                                </apex:pageblocksectionItem>
                            </apex:pageBlockSection>
                        </apex:outputPanel>
                    
                        <apex:outputPanel id="purOrder">
                            <apex:outputPanel rendered="{!(AND(formObj.PurchaseOrder__c == 'No', formObj.SubmissionType__c == 'Final Submission'))}" >
                                <p style="color:brown;">
                                    Warning: You have indicated that a purchase order has not been submitted. The Release to Mask (RTM) for this program may be delayed.
                                </p>
                            </apex:outputPanel>
                            <apex:outputPanel rendered="{!(AND(formObj.PurchaseOrder__c == 'Unsure', formObj.SubmissionType__c == 'Final Submission'))}" >
                                <p style="color:brown;">
                                    Warning: You have indicated that you are unsure if a PO has been submitted. If the PO has not been submitted, the Release to Mask (RTM) for 
                                    this program may be delayed.
                                </p>
                            </apex:outputPanel>
                        </apex:outputPanel>
                        <br/>
                        <apex:outputPanel id="holdId" rendered="{!(formObj.SubmissionType__c == 'Final Submission')}">
                            <apex:pageBlockSection >
                                <apex:pageblocksectionItem rendered="{!(formObj.SubmissionType__c == 'Final Submission')}">
                                    <apex:outputLabel value="Do you require GLOBALFOUNDRIES to HOLD your design for your review prior to mask build?"/>
                                    <apex:outputPanel >
                                        <div class = "requiredInput">
                                            <div class = "requiredBlock"></div>
                                            <apex:outputField value="{!formObj.RitHold__c}" />
                                        </div>
                                    </apex:outputPanel>
                                </apex:pageblocksectionItem>
                            </apex:pageBlockSection>
                        </apex:outputPanel>
                    
                        <apex:outputPanel id="ritHold" >
                            <apex:outputPanel rendered="{!(AND(formObj.RitHold__c == 'Yes', formObj.SubmissionType__c == 'Final Submission'))}" >
                                <p style="color:brown;">
                                    WARNING: RTM target will not be set until your review has been completed. To remove the "HOLD", select "Proceed to RTM" from the Possible Form 
                                    Actions menu at the top of this RIT form.
                                </p>
                                <br/>
                                <apex:pageBlockSection >
                                    <apex:pageblocksectionItem >
                                        <apex:outputLabel value="Why are you requesting a hold?"/>
                                        <apex:outputPanel >
                                            <div class = "requiredInput">
                                                <div class = "requiredBlock"></div>
                                                <apex:outputField value="{!formObj.HoldReason__c}" />
                                            </div>
                                        </apex:outputPanel>
                                    </apex:pageblocksectionItem>
                                </apex:pageBlockSection>
                            </apex:outputPanel>
                        </apex:outputPanel>
                    
                        <apex:outputPanel id="holdReason">
                            <apex:pageBlockSection >
                                <apex:pageblocksectionItem rendered="{!(AND(formObj.SubmissionType__c == 'Final Submission', if(contains(formObj.HoldReason__c,'Other'),true,false), formObj.RitHold__c == 'Yes'))}">
                                    <apex:outputLabel value="Other:"/>
                                    <apex:outputPanel >
                                        <div class = "requiredInput">
                                            <div class = "requiredBlock"></div>
                                            <apex:outputField value="{!formObj.OtherReason__c}" />
                                        </div>
                                    </apex:outputPanel>
                                </apex:pageblocksectionItem>
                            </apex:pageBlockSection>
                        </apex:outputPanel>   
                    </apex:actionRegion>
                </apex:pageBlockSection>
                
                <apex:outputPanel id="pbs3">
                    <apex:pageBlockSection title="Data Return Request" columns="1" rendered="{!formObj.SubmissionType__c == 'Final Submission'}" collapsible="false">
                        <apex:actionRegion >
                            <apex:outputPanel >
                                <apex:pageblockSection >
                                    <apex:pageblocksectionItem >
                                        <apex:outputlabel value="Would you like the Post Design Service (Cheese and Fill) data returned?"/>
                                        <apex:outputPanel >
                                            <div class = "requiredInput">
                                                <div class = "requiredBlock"></div>
                                                <apex:outputField value="{!formObj.PostDesignServices__c}" />
                                            </div>
                                        </apex:outputPanel>
                                    </apex:pageblocksectionItem>
                                </apex:pageBlockSection>
                            </apex:outputPanel>   
                            
                            <apex:outputPanel id="gdsSubset">
                                <apex:pageBlockSection >
                                    <apex:pageblocksectionItem rendered="{!AND(formObj.PostDesignServices__c == 'Yes', formObj.SubmissionType__c == 'Final Submission')}">
                                        <apex:outputlabel value="Do you need a subset of the submitted GDS?"/>
                                        <apex:outputPanel >
                                            <div class = "requiredInput">
                                                <div class = "requiredBlock"></div>
                                                <apex:outputField value="{!formObj.GdsSubset__c}" />
                                            </div>
                                        </apex:outputPanel>
                                    </apex:pageblocksectionItem>
                                </apex:pageBlockSection>
                            </apex:outputPanel>
                            
                            <apex:outputPanel id="cordinates">
                                <apex:pageBlockSection rendered="{!AND(formObj.GdsSubset__c == 'Yes',formObj.PostDesignServices__c == 'Yes')}" columns="1">
                                    <apex:pageblocksectionItem >
                                        <p style="color:black;">
                                            Please define the subset using the Lower Left and Upper Right Corners:
                                        </p>
                                        <p style="color:black;">
                                            Lower Left Corner:
                                        </p>
                                    </apex:pageblockSectionItem>
                                    
                                    <apex:pageblocksectionItem >
                                        <apex:outputlabel value="X coordinate LL Corner (um):"/>
                                        <apex:outputPanel >
                                            <div class = "requiredInput">
                                                <div class = "requiredBlock"></div>
                                                <apex:outputField value="{!formObj.LeftXCoordinate__c}" />
                                            </div>
                                        </apex:outputPanel>
                                    </apex:pageblocksectionItem>
                                    
                                    <apex:pageblocksectionItem >
                                        <apex:outputlabel value="Y coordinate LL Corner (um):"/>
                                        <apex:outputPanel >
                                            <div class = "requiredInput">
                                                <div class = "requiredBlock"></div>
                                                <apex:outputField value="{!formObj.LeftYCoordinate__c}" />
                                            </div>
                                        </apex:outputPanel>
                                    </apex:pageblocksectionItem>
                                    
                                    <p style="color:black;">
                                        Upper Right Corner:
                                    </p>
                                    <apex:pageblocksectionItem >
                                        <apex:outputlabel value="X coordinate UR Corner (um):"/>
                                        <apex:outputPanel >
                                            <div class = "requiredInput">
                                                <div class = "requiredBlock"></div>
                                                <apex:outputField value="{!formObj.RightXCoordinate__c}" />
                                            </div>
                                        </apex:outputPanel>
                                    </apex:pageblocksectionItem>
                                    
                                    <apex:pageblocksectionItem >
                                        <apex:outputlabel value="Y coordinate UR Corner (um):"/>
                                        <apex:outputPanel >
                                            <div class = "requiredInput">
                                                <div class = "requiredBlock"></div>
                                                <apex:outputField value="{!formObj.RightYCoordinate__c}" />
                                            </div>
                                        </apex:outputPanel>
                                    </apex:pageblocksectionItem>
                                </apex:pageBlockSection>
                            </apex:outputPanel>
                        </apex:actionRegion>
                    </apex:pageBlockSection>
                </apex:outputPanel>
                <apex:pageBlockSection title="Drop Box Information" columns="1" id="pbs5" collapsible="false">
                    <p style="color:brown;">
                        **At least one design file is required. Please only select your design files (or archives with design files in
                        them). Do not select files which only contain checking logs or other miscellaneous information. Available
                        selections are based on what you have access to in the Dropbox, such as non-expired packages that you have sent or received.
                    </p>
                    <apex:outputPanel id="myPanel1" >
                        <apex:outputText value="No dropbox file(s) selected" rendered="{!showMessage}"/>
                        <apex:variable value="{!0}" var="packNum"/>
                        <apex:repeat value="{!navPackWrapper}" var="p" id="packagesRep"  >
                            <apex:outputPanel rendered = "{!p.dropBoxFilesW.size > 0}">
                                <apex:variable value="{!packNum+1}" var="packNum"/>
                                <apex:pageBlockSection columns="2">
                                    <apex:pageBlockSectionItem dataStyle="width:50%;" labelStyle="width:10%">
                                        <apex:outputLabel style="bold;  margin-left: -29px;" id="packSection" value="{!packNum})Package Name(ID):"/>
                                        <apex:outputPanel >   
                                            <apex:outputText value="{!p.PackageName}" />(<apex:outputText value="{!p.PackageId}" />)
                                        </apex:outputPanel>  
                                    </apex:pageBlockSectionItem>
                                    <apex:pageBlockSectionItem dataStyle="width:100%" labelStyle="width:0%">
                                        <apex:outputPanel >   
                                            <apex:outputText style="" value="" />
                                        </apex:outputPanel>
                                        <apex:outputLabel rendered="{!p.PackageName != null && p.PackageName != '' && BEGINS(p.PackageName, 'ITAR_')}" style="color:brown;font-weight: bold;" value="Contains ITAR sensitive data"/>
                                    </apex:pageBlockSectionItem>
                                    <apex:pageBlockSectionItem >
                                        <apex:outputLabel style="bold" value="Sender:"/>
                                        <apex:outputPanel >   
                                            <apex:outputText value="{!p.senderInfo}" />
                                        </apex:outputPanel>  
                                    </apex:pageBlockSectionItem>
                                    <apex:pageBlockSectionItem dataStyle="width:20%" labelStyle="width:10%">
                                        <apex:outputLabel style="bold" value="Sent:"/>
                                        <apex:outputPanel >   
                                            <apex:outputText value="{!p.sentDate}" />
                                        </apex:outputPanel>  
                                    </apex:pageBlockSectionItem>
                                </apex:pageBlockSection>
                                <apex:outputPanel rendered="{!p.showTable && showReadOnlyView && p.dropBoxFilesW.size > 0}">
                                    <apex:outputPanel id="dropBoxFileTable" styleclass="checkTable" style="margin-left:-97px;" >
                                        <table id="dropBoxFileTable1" columns="2" border="1" class="list main-data-table" cellspacing="0" cellpadding="0" style="width:100%">
                                            <tr class="headerrows" align="left" style="  width: 12%;">
                                                <td style="font-size: 8pt;padding-left: 200pt;"><font color="#fff">File Name (ID)</font></td>
                                                <td style="font-size: 8pt;padding-left: 150pt;"><font color="#fff">File Size</font></td>
                                            </tr>
                                            <apex:repeat value="{!p.packDropBoxData}" var="pd">
                                                <apex:repeat value="{!p.packDropBoxData[pd]}" var="dfr">
                                                    <tr class="datarow">
                                                        <td class="datacell">
                                                            <apex:outputField value="{!dfr.dropBoxFile.Drop_Box_File_Name__c}"/>&nbsp;(<apex:outputField value="{!dfr.dropBoxFile.File_Id__c}"/>)
                                                        </td>
                                                        <td class="datacell">
                                                            <apex:outputText value="{!dfr.size}"/>&nbsp;(<apex:outputField value="{!dfr.dropBoxFile.Drop_Box_File_Size__c}"/>)
                                                        </td>
                                                    </tr>                               
                                                </apex:repeat>
                                            </apex:repeat>
                                        </table>
                                        <apex:actionStatus id="refresh" startText="Refreshing..." stopText=""/>
                                        <br/> 
                                    </apex:outputPanel>
                                </apex:outputPanel>
                                <br/>
                            </apex:outputPanel>
                        </apex:repeat>
                    </apex:outputPanel>
                    <br/>
                    
                    <apex:pageblocksectionItem >
                        <apex:outputlabel value="Are any of the files you selected a TAR, TGZ, ZIP  or other archive?"/>
                        <apex:outputPanel >
                            <div class = "requiredInput">
                                <div class = "requiredBlock"></div>
                                <apex:outputField value="{!formObj.IsArchive__c}" />
                            </div>
                        </apex:outputPanel>
                    </apex:pageblocksectionItem>
                    <p style="color:black;"> 
                        Note: An archive is a collection of multiple files bundled into one. Answer "Yes" if you have selected any archive files. 
                        Files can also be simply compressed, but not an archive, such as GZ. Select "No" if all your selected files are single (non-grouped) files either 
                        with or without compression.
                    </p>
                    <apex:pageblocksectionItem >
                        <apex:outputlabel value="Our automated checking will find your design file's topcell if it only has one.  Do you wish to specify a subcell, or do you have multiple topcells in any of the design files?"/>
                        <apex:outputPanel >
                            <div class = "requiredInput">
                                <div class = "requiredBlock"></div>
                                <apex:outputField value="{!formObj.IsMultipleTopCell__c}" />
                            </div>
                        </apex:outputPanel>
                    </apex:pageblocksectionItem>
                </apex:pageBlockSection>
            </apex:pageBlock>
            <apex:outputPanel rendered="{!formObj.IsArchive__c == 'Yes' && !popupVal}" >
                <apex:pageBlock title="Form Page 2" id="pb2">
                    <apex:pageBlockSection title="Drop Box Information" id="info" columns="1" collapsible="false">
                        <apex:outputField label="Are any of the files you selected a TAR, TGZ, ZIP  or other archive?" value="{!formObj.IsArchive__c}"/>
                        <br/>                   
                        <apex:outputLabel style="font-weight:bold;font-size:10pt;">Submission Details</apex:outputLabel>
                        <apex:outputLabel style="font-style:italic;font-size:10pt;"> 
                            Please specify the file type for each of the selected files. Please note for each TAR/TGZ/ZIP/Other archive you 
                            will have to manually enter the design file(s) within the archive. Manually entered file names must match exactly 
                            what is in your archive. Otherwise the release automation will not be able to find your file and you will have to 
                            correct the error. In that regard, archive files are no longer recommended since they do not allow direct selection 
                            of design files. These fields are mandatory.
                            <br/> <br/>                               
                        </apex:outputLabel>
                        
                        <apex:outputPanel layout="block" id="table1" rendered="{!showMainTable}" >
                            <apex:repeat value="{!navPackWrapper}" var="p">
                                <apex:repeat value="{!p.dropBoxFilesW}" var="mf" id="Records">
                                    <apex:outputLabel style="font-weight:bold;font-size:10pt; text-decoration: underline;"> For Dropbox file: {!mf.dropBoxFile.Drop_Box_File_Name__c}</apex:outputLabel>
                                    <br/> <br/>
                                    <apex:pageBlockSection columns="2">
                                        <apex:pageblocksectionItem dataStyle="width:80%" labelStyle="width:10%">
                                            <apex:outputLabel style="font-weight:bold;font-size:10pt;" value="File Type:" />
                                            <apex:outputPanel >
                                                <div class = "requiredInput">
                                                    <div class = "requiredBlock"></div>
                                                    <apex:outputField value="{!mf.dropBoxFile.File_Type__c}"/>
                                                </div>
                                            </apex:outputPanel>
                                        </apex:pageblocksectionItem>
                                        <apex:pageBlockSectionItem ></apex:pageBlockSectionItem>
                                    </apex:pageBlockSection>
                                    
                                    <apex:outputPanel rendered="{!(mf.dropBoxFile.File_Type__c == 'TAR / TGZ / ZIP / Other Archive')}">
                                        <br/>Please specify the exact design file(s) within the archive. Typos will cause an error in automation.
                                  <br/>
                                  
                                    <p> 
                                        *At least one design file is required.
                                    </p>
                                    <br/>
                                    </apex:outputPanel>
                                    <apex:outputPanel id="designFileTable" rendered="{!(mf.dropBoxFile.File_Type__c == 'TAR / TGZ / ZIP / Other Archive')}">
                                        <table border="1" class="list" cellspacing="0" cellpadding="0" style="width:250px">
                                            <tr class="headerRow" align="left">
                                                <td style="font-size: 8pt;">Design File Name</td>
                                            </tr>
                                            <apex:repeat value="{!mf.designDropBoxFilesW}" var="df" id="wrapperRec">
                                                <tr class="datarow">
                                                    <td class="datacell">
                                                        <apex:outputField id="designFile" value="{!df.dropBoxFile.Design_File_Name__c}" style="width:65px"/>
                                                    </td>
                                                </tr>
                                            </apex:repeat>
                                        </table>
                                        <br/>
                                    </apex:outputPanel>
                                    <br /> <br/>
                                </apex:repeat>
                            </apex:repeat>
                        </apex:outputPanel>
                    </apex:pageBlockSection>
                </apex:pageBlock>
            </apex:outputPanel>
            <apex:outputPanel rendered="{!formObj.IsMultipleTopCell__c == 'Yes' && !popupVal}">
                <apex:pageBlock title="Form Page 3" id="pb3">
                    <apex:pageBlockSection title="TopCell Details" id="info" columns="1" collapsible="false">
                        <apex:outputField label="Our automated checking will find your design file's topcell if it only has one.  Do you wish to specify a subcell, or do you have multiple topcells in any of the design files?" value="{!formObj.IsMultipleTopCell__c}"/>
                        <apex:outputLabel style="font-style:italic;font-size:10pt;"> 
                            Specifying topcells is optional unless you have more than one or need to override our automated
                            checking. If you do enter topcells, please be exact. Typos will cause an error in automation.
                            <br/> <br/>                               
                        </apex:outputLabel>
                        
                        <apex:outputPanel layout="block" id="table1" >
                            <apex:repeat value="{!navPackWrapper}" var="p">
                                <apex:repeat value="{!p.dropBoxFilesW}" var="mf" id="Records">
                                    <apex:outputLabel style="font-weight:bold;font-size:10pt; text-decoration: underline;" rendered="{!mf.dropBoxFile.File_Type__c == 'Design File'}"> For Design file: {!mf.dropBoxFile.Drop_Box_File_Name__c}</apex:outputLabel>
                                    <apex:outputPanel id="designFileTable" rendered="{!mf.dropBoxFile.File_Type__c == 'Design File'}">
                                        <br/> <br/>
                                        <html>                                      
                                            <table border="1" class="list" cellspacing="0" cellpadding="0" style="width:250px">
                                                <tr class="headerRow" align="left">
                                                    <td style="font-size: 8pt;">Topcell</td>
                                                </tr>
                                                <apex:repeat value="{!mf.TopCellDropBoxFilesW}" var="tp" id="Records1">
                                                    <tr class="datarow">
                                                        <td class="datacell">
                                                            <apex:outputField id="designFile" value="{!tp.dropBoxFile.TopCellName__c}" style="width:35px"/>
                                                        </td>
                                                    </tr>
                                                </apex:repeat>
                                            </table>
                                        </html>
                                        <br/>
                                    </apex:outputPanel>
                                    <apex:repeat value="{!mf.DesignDropBoxFilesW}" var="des" id="Records2" rendered="{!mf.dropBoxFile.File_Type__c != 'Design File'}">
                                        <apex:outputLabel style="font-weight:bold;font-size:10pt; text-decoration: underline;"> For Design file: {!des.dropBoxFile.Design_File_Name__c}</apex:outputLabel>
                                        <apex:outputPanel id="designFileTable">
                                            <br/> <br/>
                                            <html>                                      
                                                <table border="1" class="list" cellspacing="0" cellpadding="0" style="width:250px">
                                                    <tr class="headerRow" align="left">
                                                        <td style="font-size: 8pt;">Topcell</td>
                                                    </tr>
                                                    <apex:repeat value="{!des.TopCellDropBoxFilesW}" var="tp" id="Records1">
                                                        <tr class="datarow">
                                                            <td class="datacell">
                                                                <apex:outputField id="designFile" value="{!tp.dropBoxFile.TopCellName__c}" style="width:35px"/>
                                                            </td>
                                                        </tr>
                                                    </apex:repeat>
                                                </table>
                                            </html>
                                            <br/>
                                        </apex:outputPanel>
                                    </apex:repeat>
                                </apex:repeat>
                            </apex:repeat>
                        </apex:outputPanel>
                    </apex:pageBlockSection>
                </apex:pageBlock>
            </apex:outputPanel>
            <apex:pageBlockButtons location="bottom" rendered="{!!popupVal}">
            <apex:commandLink action="{!redirectToSearchPage}" value="Form Selection" styleClass="btn" style="text-decoration:none;padding:4px;" />
                <apex:commandLink action="{!openPDF}" target="_blank" value="Print PDF" styleClass="btn" style="text-decoration:none;padding:4px;" id="theButton"/>
            </apex:pageBlockButtons>
        </apex:pageblock>
    </apex:form>
</apex:page>