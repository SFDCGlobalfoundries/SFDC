<!--
Author: Cognizant Technology Solutions
Created Date: 17-5-2013
Reason: This visualforce page will be used to override standard NEW button of Team Room object. 
-->

<apex:page standardController="Team_Room__c" extensions="ClsTeamRoomController">
<apex:form >

<apex:includeScript value="{!URLFOR($Resource.jQuery_FoundryView2, 'jquery-1.8.2.min.js')}" />
<apex:includeScript value="{!URLFOR($Resource.jQuery_FoundryView2, 'ui/jquery-ui-1.9.1.custom.min.js')}" />
<!-- 
<script src="https://cs5.salesforce.com/soap/ajax/26.0/connection.js"/>
<script src="https://cs5.salesforce.com/js/functions.js"/>
 -->
<script src="/soap/ajax/26.0/connection.js"/>
<script src="/js/functions.js"/>
 
<apex:stylesheet value="{!URLFOR($Resource.jQuery_FoundryView2, 'ui/css/ui-lightness/jquery-ui-1.9.1.custom.min.css')}"/>

<script>

var j$ = jQuery.noConflict(); 

function gotoAccept(){
    
    var communityPath = '{!JSENCODE(communityPath)}';
    var retURL = '{!JSENCODE(retURL)}';
    var recordType = '{!JSENCODE(recordType)}';
    var ent = '{!JSENCODE(ent)}';
    var keyPrefix = '{!JSENCODE(keyPrefix)}';
    window.location.href=communityPath+'apex/VFTempTeamRoom?retURL='+retURL+'&recordType='+recordType+'&ent='+ent+'&keyPrefix='+keyPrefix;
    
}

function gotoDecline(){
    var communityPath = '{!communityPath}'; 
    window.location.href = communityPath+'a0J/o';
}   

function checkUser() {
    var profileFlag = '{!profileFlag}';   
    
    if(profileFlag === 'true') {
        return false;
    } else {
         return true;
    }
}

// Updated by: Cognizant on Sep-17-2013
// Reason: JQuery event Document.Ready() not preperly working in UAT sandbox.
//j$(document).ready(function () {   
  j$ (window).load(function () {            
    //var parent_host=window.location.host; 
    var flag = checkUser();   
    
    var terms = '{!termsandConditions}';
    var correctAccount = '{!correctAccount}';
    var recordType = '{!recordType}';
    var recordTypeName = '{!recordTypeName}';
       
    if(flag === false) {
    if(recordTypeName != 'Pre FV2 Teamroom'){//added for new Record Type
        if(correctAccount === 'true'){
            var iframe_url =  "<textarea rows='12' cols='105' readonly='readonly' style='font-size:14px;font-family:Times New Roman'>"+terms+"</textarea><br><input type='submit' value='Accept' onClick='gotoAccept()'> <input type='submit' value='Decline' onClick='gotoDecline()'> ";
            
            var j$modalDialog = j$('<div></div>')
            .html(iframe_url) 
            .dialog({ 
                autoOpen: false, 
                closeOnEscape: false,
                title: 'Terms and Conditions', 
                resizable: false, 
                width: 700, 
                height: 320, 
                autoResize: true, 
                modal: true, 
                draggable: false,
            });    
            
            j$modalDialog.dialog({
               open: function(event, ui) { j$(".ui-dialog-titlebar-close").hide(); }
            });             
            
            j$modalDialog.dialog('open');            
            
        } else { 
            var iframe_url =  "<textarea rows='4' cols='82' readonly='readonly'>As you are not the Owner of this Account, hence you cannot create Team Room from it.</textarea><br><input type='submit' value='Cancel' onClick='gotoDecline()'> ";
            
            var j$modalDialog = j$('<div></div>')
            .html(iframe_url) 
            .dialog({ 
                autoOpen: false, 
                closeOnEscape: false,
                title: 'Access Denied', 
                resizable: false, 
                width: 470, 
                height: 365, 
                autoResize: true, 
                modal: true, 
                draggable: false,
            });    
            
            j$modalDialog.dialog({
               open: function(event, ui) { j$(".ui-dialog-titlebar-close").hide(); }
            });             
            
            j$modalDialog.dialog('open');
            
        }
       }else{
           gotoAccept();
       }
    }
    else {       
        callMe();
    }    

});

</script>



<apex:actionFunction name="callMe" action="{!redirectSystemAdminPage}" immediate="true"/>
</apex:form>
</apex:page>