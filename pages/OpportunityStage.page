<apex:page standardcontroller="opportunity" extensions="OpportunityStageController" showHeader="false" sidebar="false" showChat="false"  standardStylesheets="true">


    <div class="slds-scope" >
  <apex:PageMessages />
   <apex:form id="theForm">  
       <apex:pageBlock mode="Edit" title="Select Opportunity Stage"  id="thepageBlock">
	   <apex:outputText value="{!headerMessage}" style="font-weight:bold" escape="false"/>
           <apex:pageBlockSection columns="2">
                <apex:pageBlockSectionItem >
                    <apex:outputLabel title="{!$ObjectType.Opportunity.fields.stagename.inlineHelpText}" value="{!$ObjectType.Opportunity.fields.stagename.label}" />
                    <apex:outputPanel id="oppStageId">
                    <apex:selectList value="{!Stage}" multiselect="false" size="1">
                    <apex:selectOptions value="{!ClosedStages}"/>
                    <apex:actionSupport event="onchange" rerender="thepageBlock" status="ProcessingStatus" />
                    </apex:selectList>
                    </apex:outputPanel>
                </apex:pageBlockSectionItem>
               <!-- <apex:pageBlockSectionItem rendered="{!OR(Stage =='Lost',Stage =='Dropped')}">
                <apex:outputLabel title="{!$ObjectType.Opportunity.fields.Reason_for_Loss_Dropped__c.inlineHelpText}" value="{!$ObjectType.Opportunity.fields.Reason_for_Loss_Dropped__c.label}" />
                    <apex:outputPanel id="oppRFLId">
                    <apex:selectList value="{!reasonForLostDropped}" multiselect="false" size="1">
                    <apex:selectOptions value="{!ReasonForLostDroppedValues}"/>
                    </apex:selectList>
                    </apex:outputPanel>
                </apex:pageBlockSectionItem> -->
         </apex:pageBlockSection>
         <apex:pageBlockButtons location="bottom">
                <apex:commandButton style="margin-top:10px;" value="Continue" action="{!next}"/>&nbsp;&nbsp;&nbsp;
                <apex:commandButton style="margin-top:10px;" value="Close" onclick="cancel();" Immediate="true"/>
         </apex:pageBlockButtons>
       </apex:pageBlock>
       <apex:actionStatus id="ProcessingStatus">
        <apex:facet name="start">
            <div><img class="waitingImage" src="/img/loading.gif" title="Processing...Please Wait..."/>Processing...Please Wait...</div>
        </apex:facet>
        </apex:actionStatus> 
   </apex:form>
        </div>
    <script>
    
    function cancel(){
		try{
            if(parent.location.href.indexOf('lightning')!=-1)
                parent.location.href='/one/one.app#/sObject/{!oppId}/view';
            else window.close();
        }catch(e){
            parent.location.href='/one/one.app#/sObject/{!oppId}/view';
        }
    }
        
    </script>
    
    
</apex:page>