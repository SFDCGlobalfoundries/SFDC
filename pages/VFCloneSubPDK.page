<!--
Type Name: VFCloneSubPDK.page
Author: Cognizant 
Created Date: 30-05-2013
Reason: The page is used to clone sub PDK from the master PDK detail page.
Change History:
Author: Sunita
Modified Date: 9th June 2015
Reason:Summer release impact changes
-->



<apex:page standardController="Sub_PDK__c" extensions="ClsCloneSubPDK" id="pageId">

    <apex:includeScript value="{!URLFOR($Resource.myjQuery, 'js/jquery-1.6.2.min.js')}"/>
    <apex:includeScript value="{!URLFOR($Resource.myjQuery, 'js/jquery-ui-1.8.16.custom.min.js')}"/> 
    <apex:stylesheet value="{!URLFOR($Resource.GF_DQ_JQueryLatest, '/jquery-ui-1.10.3/themes/base/jquery-ui.css')}"/>
    <apex:includeScript value="{!URLFOR($Resource.GF_DQ_jQueryLib, '/jquery.blockUI.js')}"/>
    <apex:includeScript value="https://code.jquery.com/jquery-1.11.0.min.js"/>
    
    <script type="text/javascript">
            
        $j = jQuery.noConflict();
        
        function checkAll(checkbox,section)
        {
            $j('.'+section).each(function() {
                  this.checked = checkbox.checked;
            }); 
        }
        
        function SaveBundle(){
           var status;
           var bundleName = document.getElementById('pageId:theForm:Pageblockid:Pageblocksectionid:Fieldset:1:Inputfieldid').value;
           if(bundleName != null){
            var regExp = /^[a-zA-Z0-9\-._ ]+$/;
            if(!regExp.test(bundleName)){
                alert('Bundle Name can only contain alphanumeric characters, hyphens(-),underscore(_) and dot(.)');
                return false;                                       
            }       
           }
           if(document.getElementById('pageId:theForm:hiddenId')!=null){
                status = document.getElementById('pageId:theForm:hiddenId').value;
           }
           if (status=='true'){
              $('<div></div>').appendTo('body')
                      .html('<div><h6>You have selected Specification with Internal Release status and that will not be accessible/visible to the customer.<br> Do you want to proceed ?</br></h6></div>')
                      .dialog({
                              modal: true, 
                              title: 'message', 
                              zIndex: 10000, 
                              autoOpen: true,
                              width: 'auto', 
                              resizable: false,
                              buttons: {
                                      Yes: function () {
                                         $.blockUI({ css: { backgroundColor: '##0174DF', color: '#FAFAFA'} }); 
                                         saveSubPDK();
                                         $(this).dialog("close");
                                      },
                                      No: function () {
                                          $(this).dialog("close");
                                      }
                              },
                              close: function (event, ui) {
                                  $(this).remove();
                              }
                    });
               
           } else {
                $.blockUI({ css: { backgroundColor: '##0174DF', color: '#FAFAFA'} }); 
                saveSubPDK();
           } 
       } 
       
        //function to unblock the page  
      function unblockPage(){  
         $.unblockUI();  
      }   
        
    </script>
    <apex:sectionHeader title="PDK Clone" subtitle="Clone PDK"/>  
    
    <apex:form id="theForm">
        <apex:actionFunction action="{!saveSubPdk}" name="saveSubPDK" oncomplete="unblockPage()" reRender="msg"/>
        <apex:pageBlock mode="detail" title="PDK Clone" id="Pageblockid">
            <apex:pagemessages id="msg"/>
            
            <apex:pageBlockButtons location="both">
                <apex:outputPanel id="mainbtn">
                    <apex:outputPanel rendered="{!editpanel}">
                        <apex:commandButton value="Save" action="{!validateStatus}" reRender="hiddenId" oncomplete="return SaveBundle();"/>
                        <!--<apex:commandButton value="Save" action="{!saveSubPdk}" status="SaveStatus" reRender="msg"/>-->
                        <apex:commandButton value="Cancel" action="{!cancel}" immediate="true"/>
                        
                        <apex:actionStatus id="SaveStatus">
                            <apex:facet name="start" >
                                <apex:image url="/img/loading32.gif" height="20px"/>                       
                            </apex:facet>
                        </apex:actionStatus>
                    </apex:outputPanel>
                </apex:outputPanel>
            </apex:pageBlockButtons>
            
            <apex:outputPanel id="editpanel">
                <apex:outputPanel rendered="{!editpanel}">
                    <apex:pageBlockSection collapsible="true" title="PDK Information" columns="2" id="Pageblocksectionid">
                    
                        <apex:repeat value="{!$ObjectType.Sub_PDK__c.FieldSets.ReadOnlyFields}" var="f">
                            <apex:outputField value="{!SubPDK[f]}"/>                    
                        </apex:repeat>
                    
                        <apex:repeat value="{!$ObjectType.Sub_PDK__c.FieldSets.InputFields}" var="f" id="Fieldset">
                            <apex:inputField value="{!subPDK[f]}" id="Inputfieldid" style="{!IF(((f == 'Description__c' || f =='Special_Instructions_for_PDK_ReleaseTeam__c')), 'width:332px;height:76px;', '')}"> <!--required="{!IF(OR(f == 'Name',f == 'Release_Status__c'),true,false)}"> -->                   
                        
                                <apex:actionSupport event="onchange" action="{!showWLAccountSection}" reRender="msg,wlpanel,accountsearchClick" status="rsStatus" rendered="{!IF(f == 'Release_Status__c',true,false)}">
                            
                                    <apex:actionStatus id="rsStatus">
                                        <apex:facet name="start" >
                                            <apex:image url="/img/loading32.gif" height="20px"/>                       
                                        </apex:facet>
                                    </apex:actionStatus>
                                </apex:actionSupport>
                            </apex:inputField>
                        </apex:repeat>
                        
                        <apex:outputPanel id="accountsearchClick" style="padding-left:20%;">                        
                            <apex:commandLink style="color:green;font-weight:bold;" action="{!clearSearch}" rendered="{!wlpanel}" reRender="editpanel,mainbtn,searchPanel">
                                <apex:image url="/img/icon/accounts16.png"/>
                                Add Account
                            </apex:commandLink>
                                                                     
                        </apex:outputPanel>
                                        
                    </apex:pageBlockSection>
            
                    <apex:pageBlockSection id="designspecsection"  collapsible="true" title="Select Master PDK Design Spec" columns="1" >
                    
                        <apex:pageblockTable value="{!PDKDesignSpec}" var="ds" rendered="{!IF(PDKDesignSpec.size>0,true,false)}" width="90%">
                            <apex:column >
                            
                                <apex:facet name="header">
                                        <apex:inputcheckbox id="selectAllDesignSpec" onclick="checkAll(this,'DesignSpec')" />
                                    </apex:facet>                                
                            
                                <apex:inputCheckbox value="{!ds.isChecked}" styleClass="DesignSpec"/>
                            </apex:column>
                            
                            <apex:repeat value="{!$ObjectType.Design_Spec__c.FieldSets.SelectDesignSpec}" var="f">
                                <apex:column value="{!ds.designSpec[f]}"/>
                            </apex:repeat>
        
                        </apex:pageblockTable>
                        <apex:outputLabel value="No records found" rendered="{!!IF(PDKDesignSpec.size>0,true,false)}"/>
                    
                    </apex:pageBlockSection>
                    
                    <apex:pageBlockSection id="designspecPatchsection" collapsible="true" title="Select Master PDK Patch Design Spec" columns="1" >
                        
                        <apex:pageblockTable value="{!patchDesignSpec}" var="ds" rendered="{!IF(patchDesignSpec.size>0,true,false)}" width="90%">
                            <apex:column >
                            
                                <apex:facet name="header">
                                        <apex:inputcheckbox id="selectAllDesignSpec" onclick="checkAll(this,'DesignSpecPatch')" />
                                    </apex:facet>                                
                            
                                <apex:inputCheckbox value="{!ds.isChecked}" styleClass="DesignSpecPatch"/>
                            </apex:column>
                            
                            <apex:repeat value="{!$ObjectType.Design_Spec__c.FieldSets.SelectDesignSpec}" var="f">
                                <apex:column value="{!ds.designSpec[f]}"/>
                            </apex:repeat> 
                            <apex:column headerValue="Patch Name">
                                <apex:outputText value="{!ds.designSpec.PDK_Patch_Name__c}"/>
                            </apex:column>   
                        </apex:pageblockTable>
                        
                         <apex:outputLabel value="No records found" rendered="{!!IF(patchDesignSpec.size>0,true,false)}"/>
                         
                    </apex:pageBlockSection>
                    
                    <apex:outputPanel id="wlpanel">
                        <apex:pageBlockSection title="White List" columns="1" rendered="{!wlpanel}">
                            <apex:pageblockTable value="{!subPdkWhiteList}" var="wl" rendered="{!IF(subPdkWhiteList.size>0,true,false)}" width="90%">
                                <apex:column >
                                    <apex:facet name="header">
                                        <apex:inputcheckbox id="selectAllWhiteList" onclick="checkAll(this,'WhiteList')" />
                                    </apex:facet>
                                
                                    <apex:inputCheckbox value="{!wl.isChecked}" styleClass="WhiteList"/>
                                </apex:column>
                                
                                <apex:repeat value="{!$ObjectType.Account.FieldSets.WhiteListFields}" var="f">
                                    <apex:column value="{!wl.accountfound[f]}"/>
                                </apex:repeat>
            
                            </apex:pageblockTable>
                            <apex:outputLabel value="No records found" rendered="{!!IF(subPdkWhiteList.size>0,true,false)}"/>
                        </apex:pageBlockSection>
                    </apex:outputPanel>
                    
                </apex:outputPanel>        
            </apex:outputPanel>
            
            
            <apex:outputpanel id="searchPanel">
                <apex:outputPanel rendered="{!searchpanel}">
                    <apex:pageBlockSection title="Search Accounts" columns="1">
                        
                        <apex:outputPanel style="padding-left:30%;padding-top:10%;padding-bottom:10%;">
                                           
                            <apex:inputText value="{!searchString}" styleClass="ui-corner-all"/> &nbsp;&nbsp;&nbsp;                                       
                            <apex:commandButton value="Search" reRender="searchresultpanel,msg" action="{!searchAccount}" status="searchStatus"/>
                            
                            <apex:actionStatus id="searchStatus">
                                <apex:facet name="start" >
                                    <apex:image url="/img/loading32.gif" height="20px"/>                       
                                </apex:facet>
                            </apex:actionStatus>
                            
                        </apex:outputPanel>    
                        
                        
                        <apex:outputPanel id="searchresultpanel">
                            <apex:pageBlockTable value="{!accountSearchList}" var="ac" rendered="{!IF(accountSearchList.size>0,true,false)}">
                                <apex:column >
                                    <apex:inputCheckbox value="{!ac.isChecked}" />
                                </apex:column>
                                
                                <apex:repeat value="{!$ObjectType.Account.FieldSets.WhiteListFields}" var="f">
                                    <apex:column value="{!ac.accountFound[f]}"/>
                                </apex:repeat>
                            </apex:pageBlockTable>
                            
                            <apex:outputLabel value="No records found" rendered="{!!IF(accountSearchList.size>0,true,false)}"/>
                            <br/>
                            <apex:outputPanel rendered="{!IF(accountSearchList.size>0,true,false)}">
                                <apex:commandButton value="Add Selected Accounts" action="{!addSelectedAccounts}" status="addAccountStatus" reRender="theForm" />&nbsp;&nbsp;
                                <apex:commandButton value="Cancel"                action="{!cancelAddAccount}"    status="addAccountStatus" reRender="theForm" />
                            </apex:outputPanel>
                           
                            <apex:actionStatus id="addAccountStatus">
                                <apex:facet name="start" >
                                    <apex:image url="/img/loading32.gif" height="20px"/>                       
                                </apex:facet>
                            </apex:actionStatus>
                            
                        </apex:outputPanel>
                    </apex:pageBlockSection>
                </apex:outputPanel>
            </apex:outputpanel>
        </apex:pageBlock>   
        <apex:inputHidden value="{!isTrue}" id="hiddenId"/>     
    </apex:form>
</apex:page>