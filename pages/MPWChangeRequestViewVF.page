<!--
    Author: Abhita Bansal
    Description: This page is used as the main page for MPW Change Request Object.
    History: 
        ABansal      07202015    - Page creation.
        Poulami      01042016    - Added Corner Split fields for Wafer Form (MPW-PP28)
-->

<apex:page id="MPWChangeRequestViewVF" standardController="MPW_Change_Request__c" extensions="MPWChangeRequestViewController" sidebar="false" showHeader="{!IF(isExternalUser == false,true,false)}" tabstyle="MPW_Change_Request__c">
    
    <apex:sectionHeader title="Change Request" subtitle="{!mpwChangeRequest.Name}" help="https://help.salesforce.com/htviewhelpdoc?id=co_edit.htm&siteLang=en_US" />
    <apex:pageMessages id="errorSection" /> 
    
    <apex:form id="form">
        <apex:pageBlock id="ChangeReq">
            <apex:pageBlockSection id="ViewPage" columns="2" title="MPW Change Request View" collapsible="false">
                 <apex:outputField value="{!mpwChangeRequest.Status__c}"/>
                 <apex:outputText value="{!IF(mpwChangeRequest.Request_Type__c=='Wafer Form Delivery','Quantity Change',mpwChangeRequest.Request_Type__c)}" label="Request Type"/>
                 <apex:outputField value="{!mpwChangeRequest.Name}"/>
                 <apex:outputField value="{!mpwChangeRequest.MPW_Form__c}"/>
                 <apex:outputField value="{!mpwChangeRequest.MPW_Prime_Die__r.Prime_Die_Name__c}"/>
                 <apex:outputField value="{!mpwChangeRequest.Drawn_Die_Size_X_um__c}" rendered="{!IF(mpwChangeRequest.Request_Type__c == 'Drawn Die Size Change', true, false)}"/>
                 <apex:outputField value="{!mpwChangeRequest.Drawn_Die_Size_Y_um__c}" rendered="{!IF(mpwChangeRequest.Request_Type__c == 'Drawn Die Size Change', true, false)}"/>
                 <apex:outputField value="{!mpwChangeRequest.Delivery_Qty_Die_Form__c}" rendered="{!IF(AND(mpwChangeRequest.Request_Type__c == 'Wafer Form Delivery', mpwChangeRequest.Delivery_Qty_Die_Form__c != null), true, false)}"/>
                 <apex:outputField value="{!mpwChangeRequest.Delivery_Qty_Wafer_Form__c}" rendered="{!IF(mpwChangeRequest.Request_Type__c == 'Wafer Form Delivery', true, false)}"/>
                 <apex:outputField value="{!mpwChangeRequest.Corner_Split__c}" rendered="{!IF(mpwChangeRequest.Request_Type__c == 'Corner Split Change', true, false)}"/>
                 <apex:outputField value="{!mpwChangeRequest.CornerSplitAttached__c}" rendered="{!IF(mpwChangeRequest.Request_Type__c == 'Corner Split Change', true, false)}"/>
                 <apex:outputField value="{!mpwChangeRequest.POR__c}" rendered="{!IF(mpwChangeRequest.Request_Type__c == 'Corner Split Change', true, false)}"/>
                 <apex:outputField value="{!mpwChangeRequest.FF__c}" rendered="{!IF(mpwChangeRequest.Request_Type__c == 'Corner Split Change', true, false)}"/>
                 <apex:outputField value="{!mpwChangeRequest.SS__c}" rendered="{!IF(mpwChangeRequest.Request_Type__c == 'Corner Split Change', true, false)}"/>
                 <apex:outputField value="{!mpwChangeRequest.FS__c}" rendered="{!IF(mpwChangeRequest.Request_Type__c == 'Corner Split Change', true, false)}"/>
                 <apex:outputField value="{!mpwChangeRequest.SF__c}" rendered="{!IF(mpwChangeRequest.Request_Type__c == 'Corner Split Change', true, false)}"/>
                 <!-- 01042016 - Added by Poulami Starts --> 
                 <apex:outputField value="{!mpwChangeRequest.Wafer_POR__c}" rendered="{!IF(mpwChangeRequest.Request_Type__c == 'Corner Split Change', true, false)}"/>
                 <apex:outputField value="{!mpwChangeRequest.Wafer_FF__c}" rendered="{!IF(mpwChangeRequest.Request_Type__c == 'Corner Split Change', true, false)}"/>
                 <apex:outputField value="{!mpwChangeRequest.Wafer_SS__c}" rendered="{!IF(mpwChangeRequest.Request_Type__c == 'Corner Split Change', true, false)}"/>
                 <apex:outputField value="{!mpwChangeRequest.Wafer_FS__c}" rendered="{!IF(mpwChangeRequest.Request_Type__c == 'Corner Split Change', true, false)}"/>
                 <apex:outputField value="{!mpwChangeRequest.Wafer_SF__c}" rendered="{!IF(mpwChangeRequest.Request_Type__c == 'Corner Split Change', true, false)}"/>
                 <!-- 01042016 - Added by Poulami Ends -->
                 <apex:outputField value="{!mpwChangeRequest.Backgrind__c}" rendered="{!IF(mpwChangeRequest.Request_Type__c == 'Backgrind Change', true, false)}"/>
                 <apex:outputField value="{!mpwChangeRequest.Sub_Devices_Extraction__c}" rendered="{!IF(mpwChangeRequest.Request_Type__c == 'Sub Devices Extraction', true, false)}"/>
                 <apex:outputField value="{!mpwChangeRequest.SubDevicesExtractionAttached__c}" rendered="{!IF(mpwChangeRequest.Request_Type__c == 'Sub Devices Extraction', true, false)}"/>
                 <apex:outputField value="{!mpwChangeRequest.Expedite_In_DIE_Form__c}" rendered="{!IF(mpwChangeRequest.Request_Type__c == 'Expedite Change', true, false)}"/>
                 <apex:outputField value="{!mpwChangeRequest.Expedite_In_WAFER_Form__c}" rendered="{!IF(mpwChangeRequest.Request_Type__c == 'Expedite Change', true, false)}"/>
                 <apex:outputField value="{!mpwChangeRequest.Turnkey_Service__c}" rendered="{!IF(mpwChangeRequest.Request_Type__c == 'Turnkey Services Change', true, false)}"/>
                 <apex:outputField value="{!mpwChangeRequest.TurnkeyAttached__c}" rendered="{!IF(mpwChangeRequest.Request_Type__c == 'Turnkey Services Change', true, false)}"/>
                 <apex:outputField value="{!mpwChangeRequest.Address1_Quantity_Delivery_In_DIE_Form__c}" rendered="{!IF(OR(mpwChangeRequest.Request_Type__c == 'Extra Dies/Wafer Re-start', mpwChangeRequest.Request_Type__c == 'Wafer Form Delivery'), true, false)}"/>
                 <apex:outputField value="{!mpwChangeRequest.Address1_Quantity_Delivery_In_WAFER_Form__c}" rendered="{!IF(OR(mpwChangeRequest.Request_Type__c == 'Extra Dies/Wafer Re-start', mpwChangeRequest.Request_Type__c == 'Wafer Form Delivery'), true, false)}"/>
                 <apex:outputField value="{!mpwChangeRequest.Address2_Quantity_Delivery_In_DIE_Form__c}" rendered="{!IF(AND(OR(mpwChangeRequest.Request_Type__c == 'Extra Dies/Wafer Re-start', mpwChangeRequest.Request_Type__c == 'Wafer Form Delivery'),mpwChangeRequest.Address2_Quantity_Delivery_In_DIE_Form__c != null), true, false)}"/>
                 <apex:outputField value="{!mpwChangeRequest.Address2_Quantity_Delivery_In_WAFER_Form__c}" rendered="{!IF(AND(OR(mpwChangeRequest.Request_Type__c == 'Extra Dies/Wafer Re-start', mpwChangeRequest.Request_Type__c == 'Wafer Form Delivery'),mpwChangeRequest.Address2_Quantity_Delivery_In_WAFER_Form__c != null), true, false)}"/>
                 <apex:outputField value="{!mpwChangeRequest.Address3_Quantity_Delivery_In_DIE_Form__c}" rendered="{!IF(AND(OR(mpwChangeRequest.Request_Type__c == 'Extra Dies/Wafer Re-start', mpwChangeRequest.Request_Type__c == 'Wafer Form Delivery'),mpwChangeRequest.Address3_Quantity_Delivery_In_DIE_Form__c != null), true, false)}"/>
                 <apex:outputField value="{!mpwChangeRequest.Address3_Quantity_Delivery_In_WAFER_Form__c}" rendered="{!IF(AND(OR(mpwChangeRequest.Request_Type__c == 'Extra Dies/Wafer Re-start', mpwChangeRequest.Request_Type__c == 'Wafer Form Delivery'),mpwChangeRequest.Address3_Quantity_Delivery_In_WAFER_Form__c != null), true, false)}"/>
                 <apex:outputField value="{!mpwChangeRequest.Remarks__c}" rendered="{!IF(mpwChangeRequest.Request_Type__c == 'Extra Dies/Wafer Re-start', true, false)}"/>
                 <apex:outputField value="{!mpwChangeRequest.Address1_ShortLoop_Wafer__c}" rendered="{!IF(mpwChangeRequest.Request_Type__c == 'Short Loop Change', true, false)}"/>
                 <apex:outputField value="{!mpwChangeRequest.Address2_ShortLoop_Wafer__c}" rendered="{!IF(AND(mpwChangeRequest.Request_Type__c == 'Short Loop Change',mpwChangeRequest.Address2_ShortLoop_Wafer__c != null), true, false)}"/>
                 <apex:outputField value="{!mpwChangeRequest.Address3_ShortLoop_Wafer__c}" rendered="{!IF(AND(mpwChangeRequest.Request_Type__c == 'Short Loop Change',mpwChangeRequest.Address3_ShortLoop_Wafer__c != null), true, false)}"/>
                 <apex:inputField value="{!mpwChangeRequest.Comments__c}" rendered="{!IF(AND(mpwChangeRequest.Request_Type__c == 'Extra Dies/Wafer Re-start',approveYes == true, tranxYes == false, mpwChangeRequest.Status__c != 'Accepted by Turnkey', mpwChangeRequest.Status__c != 'Accepted by CE', mpwChangeRequest.Status__c != 'Accepted by MPW Tapeout', mpwChangeRequest.Status__c != 'Void'), true, false)}"/>
                  <!-- Kanishk -->
                   <apex:outputField value="{!mpwChangeRequest.Metal_Stack__c}" rendered="{!mpwChangeRequest.Request_Type__c=='Metal Stack Change'}"/>
                 <br />
                 <br />
                 <br />
                 <apex:outputPanel rendered="{!IF(AND(mpwChangeRequest.Request_Type__c == 'Extra Dies/Wafer Re-start',approveYes == false, tranxYes == false, showApprover == true, OR(mpwChangeRequest.Status__c != 'Accepted by Turnkey', mpwChangeRequest.Status__c != 'Accepted by CE', mpwChangeRequest.Status__c != 'Accepted by MPW Tapeout')), true, false)}">
                     <apex:outputLabel styleClass="labelCol" value="Extra Dies Type:" />
                     <apex:selectRadio id="btnRadio" value="{!radioValue}">
                        <apex:selectOptions value="{!radioOptions}"/>
                     </apex:selectRadio>
                 </apex:outputPanel>
            </apex:pageBlockSection>
            
            <apex:pageBlockButtons location="bottom" rendered="{!IF(AND(mpwChangeRequest.Request_Type__c == 'Extra Dies/Wafer Re-start', isRequestor = true, mpwChangeRequest.Extra_Dies_Status__c == true, mpwChangeRequest.Status__c != 'Accepted by Turnkey', mpwChangeRequest.Status__c != 'Accepted by CE', mpwChangeRequest.Status__c != 'Accepted by MPW Tapeout'), true, false)}">
                <apex:commandButton value="Recall" action="{!recallRec}" />
            </apex:pageBlockButtons>
            
            <apex:pageBlockButtons location="bottom" rendered="{!IF(AND(mpwChangeRequest.Request_Type__c == 'Extra Dies/Wafer Re-start',approveYes == true,tranxYes == false, mpwChangeRequest.Status__c != 'Accepted by Turnkey', mpwChangeRequest.Status__c != 'Accepted by CE', mpwChangeRequest.Status__c != 'Accepted by MPW Tapeout', mpwChangeRequest.Status__c != 'Void'), true, false)}">
                <apex:commandButton value="Approve" action="{!approvedRec}" />
                <apex:commandButton value="Reject" action="{!rejectedRec}" />
                <apex:commandButton value="Cancel" action="{!cancelRec}" />
           </apex:pageBlockButtons>
           
           <apex:pageBlockTable value="{!changeReqApproverList}" var="app" rendered="{!IF(AND(mpwChangeRequest.Request_Type__c == 'Extra Dies/Wafer Re-start',changeReqApproverList != null, changeReqApproverList.size != 0), true, false)}">
               <apex:column headerValue="Action" styleClass="actionColumn" rendered="{!IF(AND(approveYes == false, tranxYes == false , showApprover == true, mpwChangeRequest.Status__c != 'Accepted by Turnkey', mpwChangeRequest.Status__c != 'Accepted by CE', mpwChangeRequest.Status__c != 'Accepted by MPW Tapeout'), true, false)}">
                   <apex:commandLink value="Approve/Reject" styleClass="actionLink" action="{!appRejRec}" rendered="{!IF(app.approverId == true, true,false)}"/>
               </apex:column>
               <apex:column headerValue="Status" value="{!app.StepStatus}" />
           </apex:pageBlockTable> 
        </apex:pageBlock>
    </apex:form>
    
    <apex:outputpanel rendered="{!IF(mpwChangeRequest.Status__c == 'Accepted by MPW Tapeout', true, false)}" >
    <apex:pageBlock title="Notes & Attachments" rendered="{!IF(OR(mpwChangeRequest.Request_Type__c == 'Corner Split Change', mpwChangeRequest.Request_Type__c == 'Turnkey Services Change', mpwChangeRequest.Request_Type__c == 'Sub Devices Extraction'), true, false)}">
        <apex:pageBlockTable value="{!lstAttachments}" var="att" rendered="{!IF(lstAttachments.size > 0, true, false)}" >
            <apex:column style="width: 100px;" >
                <apex:facet name="header">Action</apex:facet>
                <apex:outputlink value="/servlet/servlet.FileDownload?file={!att.oAttachment.Id}" rendered="{!IF(att.oAttachment != null, true, false)}"  styleClass="actionLink" target="_blank" title="View - Attachment" style="color: #015ba7;text-decoration: none;font-weight: normal;" >View</apex:outputlink>
                <apex:outputlink value="/{!att.oNote.Id}" rendered="{!IF(att.oNote != null, true, false)}" styleClass="actionLink" target="_blank" title="View - Note" style="color: #015ba7;text-decoration: none;font-weight: normal;" >View</apex:outputlink>
            </apex:column>
            <apex:column >
                <apex:facet name="header">Type</apex:facet>
                <apex:outputtext value="Attachment" rendered="{!IF(att.oAttachment != null, true, false)}" />
                <apex:outputtext value="Note" rendered="{!IF(att.oNote != null, true, false)}" />
            </apex:column>
            <apex:column >
                <apex:facet name="header">Title</apex:facet>
                <apex:outputtext value="{!att.oAttachment.Name}" rendered="{!IF(att.oAttachment != null, true, false)}" />
                <apex:outputtext value="{!att.oNote.Title}" rendered="{!IF(att.oNote != null, true, false)}" />
            </apex:column>
            <apex:column >
                <apex:facet name="header">Last Modified</apex:facet>
                <apex:outputfield value="{!att.oAttachment.LastModifiedDate}" rendered="{!IF(att.oAttachment != null, true, false)}" />
                <apex:outputfield value="{!att.oNote.LastModifiedDate}" rendered="{!IF(att.oNote != null, true, false)}" />
            </apex:column>
            <apex:column >
                <apex:facet name="header">Created By</apex:facet>
                <apex:outputfield value="{!att.oAttachment.CreatedById}" rendered="{!IF(att.oAttachment != null, true, false)}" />
                <apex:outputfield value="{!att.oNote.CreatedById}" rendered="{!IF(att.oNote != null, true, false)}" />
            </apex:column>
        </apex:pageBlockTable> 
        <apex:outputpanel rendered="{!IF(lstAttachments.size == 0, true, false)}" >
            <table class="list" border="0" cellspacing="0" cellpadding="0"><tbody><tr class="headerRow"><th scope="col" class="noRowsHeader">No records to display</th></tr>
            </tbody></table>
        </apex:outputpanel>
    </apex:pageBlock>
    </apex:outputpanel>
    
    <apex:outputpanel rendered="{!IF(mpwChangeRequest.Status__c != 'Accepted by MPW Tapeout', true, false)}" >
    <apex:relatedList subject="{!MPW_Change_Request__c}" list="CombinedAttachments" rendered="{!IF(OR(mpwChangeRequest.Request_Type__c == 'Corner Split Change', mpwChangeRequest.Request_Type__c == 'Turnkey Services Change', mpwChangeRequest.Request_Type__c == 'Sub Devices Extraction'), true, false)}"/> 
    </apex:outputpanel>
    
    <apex:relatedList list="ProcessSteps" rendered="{!IF(mpwChangeRequest.Request_Type__c != 'Extra Dies/Wafer Re-start',true,false)}"></apex:relatedList> <!--rendered="{!IF(mpwChangeRequest.Request_Type__c != 'Extra Dies/Wafer Re-start',true,false)}"-->
    <apex:relatedList list="ProcessSteps" rendered="{!IF(AND(mpwChangeRequest.Request_Type__c == 'Extra Dies/Wafer Re-start',OR(mpwChangeRequest.Status__c == 'Accepted by Turnkey', mpwChangeRequest.Status__c == 'Accepted by CE', mpwChangeRequest.Status__c == 'Accepted by MPW Tapeout')), true, false)}"></apex:relatedList>
</apex:page>