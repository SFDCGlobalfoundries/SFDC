<apex:page id="internalchargeoutreport" controller="InternalChargeOutReportController">
    <apex:stylesheet value="{!URLFOR($Resource.MPWRelatedCSS, '/MPWRelatedCSS/MPWInternalChargeOutReport.css')}" />
    <apex:stylesheet value="/sCSS/21.0/sprites/1297816277000/Theme3/default/gc/versioning.css" />
    <!-- Javascript -->
    <apex:includeScript value="{!URLFOR($Resource.jQuery_1_11_3_min, '/jquery-1.11.3.min/jquery-1.11.3.min.js')}" />
    <!-- <script src="//ajax.googleapis.com/ajax/libs/jquery/1.10.2/jquery.min.js"></script> -->
    <apex:includeScript value="{!URLFOR($Resource.MPWRelatedJS, '/MPWRelatedJS/MPWInternalChargeOutReport.js')}" />
   
    <!-- Jquery -->
    <apex:includeScript value="//code.jquery.com/jquery-1.11.3.min.js" />
    <apex:stylesheet value="//ajax.googleapis.com/ajax/libs/jqueryui/1.11.4/themes/smoothness/jquery-ui.css" />
  
    <!-- DataTable -->
    <!--<apex:includeScript value="//cdn.datatables.net/1.10.9/js/jquery.dataTables.min.js" />
    <apex:stylesheet value="//cdn.datatables.net/1.10.9/css/jquery.dataTables.min.css" /> -->
    <apex:includeScript value="{!URLFOR($Resource.datatable, '/datatable/media/js/jquery.dataTables.min.js')}" />
    <apex:stylesheet value="{!URLFOR($Resource.datatable, '/datatable/media/css/jquery.dataTables.min.css')}" />
    
    <!-- Search Highlight -->
    <apex:includeScript value="//bartaz.github.io/sandbox.js/jquery.highlight.js" />
    <apex:includeScript value="//cdn.datatables.net/plug-ins/1.10.9/features/searchHighlight/dataTables.searchHighlight.min.js" />
    <apex:stylesheet value="//cdn.datatables.net/plug-ins/1.10.9/features/searchHighlight/dataTables.searchHighlight.css" />
    

    <style>
    .filterMatches {
        background-color: #BFFF00;
    }
    
    .tertiaryPalette {
        color: #000 !important;
    }
    
    .dt-buttons {
        margin-left: 10px;
    }
    
    table.dataTable.hover tbody tr:hover,
    table.dataTable.display tbody tr:hover {
        background-color: #e3f3ff;
    }
    
    .wrapper {
        width: 40%;
        padding-top: 13px;
    }
    
    .dataTables_length {
        padding-left: 13px;
        padding-top: 5px;
    }
    </style>
    <script type="text/javascript">
    $(document).ready(function() {

        var accountsTable = $('[id$="resulttable"]').DataTable({
            "footerCallback": function(row, data, start, end, display) {
                var api = this.api(),
                    data;

                // Remove the formatting to get integer data for summation
                var intVal = function(i) {
                    return typeof i === 'string' ?
                        i.replace(/[\$,]/g, '') * 1 :
                        typeof i === 'number' ?
                        i : 0;
                };

                // Total over all pages
                for (var ii = 6; ii < 14; ii++) {
                    total = api
                        .column(ii)
                        .data()
                        .reduce(function(a, b) {
                            return intVal(a) + intVal(b);
                        }, 0);

                    // Total over this page
                    pageTotal = api
                        .column(ii, {
                            page: 'current'
                        })
                        .data()
                        .reduce(function(a, b) {
                            return intVal(a) + intVal(b);
                        }, 0);

                    // Update footer
                    $(api.column(ii).footer()).html(
                       parseFloat(Math.round(pageTotal* 100) / 100).toFixed(2) 
                    );
                }
            },
            //enables results highlight
            searchHighlight: true,
            "pagingType": "full_numbers",
            "order": [],
            //sets record lengths to show in picklist
            aLengthMenu: [
                [10, 25, 50, 100, 200, -1],
                [10, 25, 50, 100, 200, "All"]
            ],
            "language": {
                "lengthMenu": "Page Size _MENU_ ",
                "info": "Showing Page _PAGE_ of _PAGES_ (_TOTAL_ Records)",
                emptyTable:"No Records Found.",
                paginate: {
                    //next: '<img src="/s.gif" class="next1" alt="Next">',
                    //previous: '<img src="/s.gif" class="prev1" alt="Previous" >'
                }
            },
            "iDisplayLength": 10,
            //adds copy, print buttons...
            //dom: 'lfrtip', //l=length, B=buttons, f=filter(search), r=processing, t=the table, I=table summary, p=page controls
            "dom": '<"top"f>rt<"wrapper"ilp><"clear">'
        });

    });
    </script>
    <apex:form id="theform">
        <apex:pageMessages id="errormsg" />
        <apex:pageBlock id="filterform" rendered="{!fromEmail == null}">
            <apex:pageBlockButtons location="bottom" rendered="{!fromEmail == null}">
                <apex:commandButton value="Search" action="{!searchMethod}" />
                <apex:commandButton value="Reset" action="{!reset}" />
                <apex:commandButton value="Export" action="{!exportCsvFile}" rendered="{!totalNoOfRecords > 0}" />
            </apex:pageBlockButtons>
            <apex:pageBlockSection id="filtersection" title="Internal Chargeout Report" collapsible="false" columns="3">
                <apex:pageBlockSectionItem >
                    <apex:outputLabel value="MPW#" />
                    <apex:inputText value="{!mpwNo}" />
                </apex:pageBlockSectionItem>
                <apex:pageBlockSectionItem >
                    <apex:outputLabel value="Form#" />
                    <apex:inputText value="{!formNo}" />
                </apex:pageBlockSectionItem>
                <apex:pageBlockSectionItem >
                    <apex:outputLabel value="Form Status" />
                    <apex:selectList value="{!formStatus}" multiselect="false" size="1">
                        <apex:selectOptions value="{!FormStatusOptions}" />
                    </apex:selectList>
                </apex:pageBlockSectionItem>
                <apex:pageBlockSectionItem >
                    <apex:outputLabel value="Usage" />
                    <apex:selectList value="{!Usage}" multiselect="false" size="1">
                        <apex:selectOptions value="{!UsageOptions}" />
                    </apex:selectList>
                </apex:pageBlockSectionItem>
                <apex:pageBlockSectionItem >
                    <apex:outputLabel value="Category" />
                    <apex:selectList value="{!Category}" multiselect="false" size="1">
                        <apex:selectOptions value="{!CategoryOptions}" />
                    </apex:selectList>
                </apex:pageBlockSectionItem>
            </apex:pageBlockSection>
        </apex:pageBlock>
        <apex:outputPanel id="resultblock">
            <apex:pageBlock rendered="{!searchValue}">
                <apex:outputPanel rendered="{!IF(totalNoOfRecords > 0, true, false)}">
                    <table id="resulttable" class='datalist display'>
                        <thead>
                            <tr>
                                <th class='headerRow'>MPW#</th>
                                <th class='headerRow'>Customer Name</th>
                                <th>Cat.</th>
                                <th class='headerRow'>Sub-Cat.</th>
                                <th class='headerRow'>Usage</th>
                                <th class='headerRow'>Prime Die Name</th>
                                <th class='headerRow'>X Size(mm)</th>
                                <th class='headerRow'>Y Size(mm)</th>
                                <th class='headerRow'>Quanity Die Form</th>
                                <th class='headerRow'>Quantity Wafer Form</th>
                                <th class='headerRow'># of Extra dies</th>
                                <th class='headerRow'>Used Reticle Space($)</th>
                                <th class='headerRow'>Requested # of Dies($)</th>
                                <th class='headerRow'>Requested Extra Dies($)</th>
                                <th class='headerRow'>Bare Die Ship Date</th>
                                <th class='headerRow'>PA Code</th>
                                <th class='headerRow'>PA Code Name</th>
                                <th class='headerRow'>Form Status</th>
                                <th class='headerRow'>Change Request Status</th>
                                <th class='headerRow'>Change Request Type</th>
                                <th class='headerRow'>Form Number</th>
                            </tr>
                        </thead>
                        <tbody>
                        <apex:repeat value="{!PrimeDieRecords}" var="lstpcwr">
                            <apex:repeat value="{!lstpcwr}" var="pcwr">
                                <tr>
                                    <td>{!pcwr.mpwno}</td>
                                    <td>{!pcwr.customername}</td>
                                    <td>{!pcwr.cat}</td>
                                    <td>{!pcwr.subcat}</td>
                                    <td>{!pcwr.usage}</td>
                                    <td>{!pcwr.primediename}</td>
                                    <td>{!pcwr.xsize}</td>
                                    <td>{!pcwr.ysize}</td>
                                    <td>{!pcwr.quantdieform}</td>
                                    <td>{!pcwr.quantwaferform}</td>
                                    <td>{!pcwr.noofextradies}</td>
                                    <td>{!pcwr.usedrectilespace}</td>
                                    <td>{!pcwr.requesteddieno}</td>
                                    <td>{!pcwr.requestedextradie}</td>
                                    <td>{!pcwr.baredieshipdate}</td>
                                    <td>{!pcwr.pacode}</td>
                                    <td>{!pcwr.pacodedetail}</td>
                                    <td>
                                        <apex:outputpanel rendered="{!!pcwr.isChangeRequest}">{!pcwr.formstatus}</apex:outputpanel>
                                    </td>
                                    <td>
                                        <apex:outputpanel rendered="{!pcwr.isChangeRequest}">{!pcwr.formstatus}</apex:outputpanel>
                                    </td>
                                    <td>
                                        <apex:outputpanel rendered="{!pcwr.isChangeRequest}">{!pcwr.changeRequestType}</apex:outputpanel>
                                    </td>
                                    <td>{!pcwr.formno}</td>
                                </tr>
                            </apex:repeat>
                             </apex:repeat>
                        </tbody>
                        <!--<apex:column headerValue="Form Number">
                        <apex:outputLink value="/{!pcwr.formid}">{!pcwr.formno}</apex:outputLink>
                    </apex:column>-->
                        <tfoot>
                            <apex:outputPanel rendered="{!fromEmail == null}" layout="none">
                                <tr>
                                    <th colspan="6" style="text-align:right">Total:</th>
                                    <th></th>
                                    <th></th>
                                    <th></th>
                                    <th></th>
                                    <th></th>
                                    <th></th>
                                    <th></th>
                                    <th></th>
                                     <th colspan='7'></th>
                                </tr>
                            </apex:outputPanel>
                        </tfoot>
                    </table>
                </apex:outputPanel>
                <br/>
                <apex:outputPanel id="controlPanel" layout="block" rendered="{!IF(AND(totalNoOfRecords > 0,fromEmail == null), false, false)}">
                    <center>
                        <apex:commandLink action="{!first}" style="text-decoration: none;" rendered="{!IF(HasPrevious, true, false)}" rerender="controlPanel, resulttable" status="loadStatus">
                            <apex:image value="/s.gif" styleClass="first1" alt="First Page" />
                        </apex:commandLink>
                        <apex:outputPanel rendered="{!IF(NOT(HasPrevious), true, false)}">
                            <apex:image value="/s.gif" styleClass="firstoff1" alt="First Page" />
                        </apex:outputPanel>
                        &nbsp;
                        <apex:commandLink action="{!previous}" style="text-decoration: none;" rendered="{!IF(HasPrevious, true, false)}" rerender="controlPanel, resulttable" status="loadStatus">
                            <apex:image value="/s.gif" styleClass="prev1" alt="Previous" />Previous
                        </apex:commandLink>
                        <apex:outputPanel rendered="{!IF(NOT(HasPrevious), true, false)}">
                            <apex:image value="/s.gif" styleClass="prevoff1" alt="Previous" />Previous
                        </apex:outputPanel>
                        &nbsp;&nbsp;
                        <apex:commandLink action="{!next}" style="text-decoration: none;" rendered="{!IF(HasNext, true, false)}" rerender="controlPanel, resulttable" status="loadStatus">
                            Next
                            <apex:image value="/s.gif" styleClass="next1" alt="Next" />
                        </apex:commandLink>
                        <apex:outputPanel rendered="{!IF(NOT(HasNext), true, false)}">
                            Next
                            <apex:image value="/s.gif" styleClass="nextoff1" alt="Next" />
                        </apex:outputPanel>
                        &nbsp;
                        <apex:commandLink action="{!last}" style="text-decoration: none;" rendered="{!IF(HasNext, true, false)}" rerender="controlPanel, resulttable" status="loadStatus">
                            <apex:image value="/s.gif" styleClass="last1" alt="Last Page" />
                        </apex:commandLink>
                        <apex:outputPanel rendered="{!IF(NOT(HasNext), true, false)}">
                            <apex:image value="/s.gif" styleClass="lastoff1" alt="Last Page" />
                        </apex:outputPanel>
                    </center>
                </apex:outputPanel>
                <apex:outputText value="No Records Found." rendered="{!noresultfound}" />
            </apex:pageBlock>
        </apex:outputPanel>
        <apex:actionStatus onstart="startLoading();" onstop="endLoading();" id="loadStatus" />
        <div id="load_scrl" class="loadingBox loader" style="display: none" />
        <div class="loadingBox overlay" />
    </apex:form>
</apex:page>